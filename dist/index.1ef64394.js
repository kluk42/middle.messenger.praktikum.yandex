function e(e,t,n,r){Object.defineProperty(e,t,{get:n,set:r,enumerable:!0,configurable:!0})}function t(e){return e&&e.__esModule?e.default:e}var n="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof self?self:"undefined"!=typeof window?window:"undefined"!=typeof global?global:{},r={},a={},l=n.parcelRequirefc40;let s;var o;let i;var u;null==l&&((l=function(e){if(e in r)return r[e].exports;if(e in a){var t=a[e];delete a[e];var n={id:e,exports:{}};return r[e]=n,t.call(n.exports,n,n.exports),n.exports}var l=new Error("Cannot find module '"+e+"'");throw l.code="MODULE_NOT_FOUND",l}).register=function(e,t){a[e]=t},n.parcelRequirefc40=l),l.register("27Lyk",(function(t,n){var r,a;e(t.exports,"register",(()=>r),(e=>r=e)),e(t.exports,"resolve",(()=>a),(e=>a=e));var l={};r=function(e){for(var t=Object.keys(e),n=0;n<t.length;n++)l[t[n]]=e[t[n]]},a=function(e){var t=l[e];if(null==t)throw new Error("Could not resolve bundle with id "+e);return t}})),l("27Lyk").register(JSON.parse('{"1LzKV":"index.1ef64394.js","hI5MR":"messageIsReceivedIcon.2401a075.png"}')),(o=s||(s={})).BaseUrl="https://ya-praktikum.tech/api/v2",o.ResourcesUrl="https://ya-praktikum.tech/api/v2/resources",o.WSURL="wss://ya-praktikum.tech/ws/chats",(u=i||(i={})).GET="GET",u.POST="POST",u.PUT="PUT",u.PATCH="PATCH",u.DELETE="DELETE";class c{static API_URL=s.BaseUrl;constructor(e){this.endpoint=`${c.API_URL}${e}`}get(e="/",t={}){const n=t.data instanceof FormData?void 0:this.queryStringify(e,t.data);return this.request(this.endpoint+n,{...t,method:i.GET},t.timeout)}put(e,t){return this.request(this.endpoint+e,{...t,method:i.PUT},t.timeout)}post(e,t){return this.request(this.endpoint+e,{...t,method:i.POST},t.timeout)}delete(e,t){return this.request(this.endpoint+e,{...t,method:i.DELETE},t.timeout)}request(e,t,n=5e3){return new Promise((function(r,a){const{headers:l,data:s,method:o}=t,u=s instanceof FormData,c=new XMLHttpRequest;c.open(o,e),c.timeout=n,l&&Object.entries(l).forEach((([e,t])=>{c.setRequestHeader(e,t)})),c.onload=function(){if(c.status<400){const e=c.response;r(e)}else a(c.response)},u||c.setRequestHeader("Content-Type","application/json"),c.withCredentials=!0,c.responseType="json",c.onabort=a,c.onerror=a,c.ontimeout=a,u?c.send(s):o!==i.GET&&s?c.send(JSON.stringify(s)):c.send()}))}queryStringify(e,t){if(t){let n="?";return Object.entries(t).forEach((([e,t])=>{n+=`${e}=${t}&`})),e+n.slice(0,-1)}return e}}const p=async(e,t,n)=>{const{retries:r,method:a}=n;let l=null;switch(a){case i.DELETE:l=e.delete.bind(e);break;case i.POST:l=e.post.bind(e);break;case i.PUT:l=e.put.bind(e);break;default:l=e.get.bind(e)}let s=0;try{return await l(t,n)}catch(e){if(null===l)throw e;if(s===r)throw e;return s+=1,l(t,n)}};class h{constructor(e){this.http=new c(e)}}class d extends h{constructor(){super("/auth")}signup(e){return p(this.http,"/signup",{method:i.POST,retries:1,data:e})}signin(e){return p(this.http,"/signin",{method:i.POST,retries:1,data:e})}async getUser(){return p(this.http,"/user",{method:i.GET,retries:1})}async logout(){return p(this.http,"/logout",{method:i.POST,retries:1})}create=void 0;read=void 0;update=void 0;delete=void 0}function m(e,t){return void 0===t?e.trim():e.replace(new RegExp(`^[${t}]+|[${t}]+$`,"gm"),"")}let f;var g;function y(e,t){const n=document.querySelector(e);if(null===n)throw new Error(`root not found by selector "${e}"`);return n.innerHTML="",n.append(t.getContent()),t.dispatchComponentDidMount(),n}(g=f||(f={})).SignInPage="sign-in",g.SignUpPage="sign-up",g.Chat="chat",g.EditProfilePage="edit-profile",g.EditPasswordPage="edit-password",g.Profile="profile",g.NotFoundPage="not-found",g.ServerError="server-error";class v{block=null;constructor(e,t,n,r){this.pathName=e,this.blockClass=t,this.props=n,this.query=r}navigate(e){this.match(e)&&(this.pathName=e,this.render())}leave(){this.block=null}match(e){return e===this.pathName}render(){if(!this.block)return this.block=new this.blockClass(this.props),void y(this.query,this.block);y(this.query,this.block)}}class _{constructor(e){if(this.query=e,this.routes=[],this.history=window.history,this.currentRoute=null,_.instance)return _.instance;_.instance=this,this.query=e}use(e,t,n){const r=new v(e,t,n,this.query);return this.routes.push(r),this}start(){window.onpopstate=e=>{const t=e.currentTarget,n="/"===t.location.pathname?f.SignInPage:m(t.location.pathname,"/");this.onRoute(n)}}onRoute(e){const t=this.getRoute(e);t?(this.currentRoute&&this.currentRoute.leave(),t.render()):this.go(f.NotFoundPage)}getRoute(e){return this.routes.find((t=>t.match(e)))??null}go(e){this.history.pushState({},"",e),this.onRoute(e)}back(){this.history.back()}forward(){this.history.forward()}replace(e){this.history.replaceState({},"",e),this.onRoute(e)}getCurrentPathName(){return m(window.location.pathname,"/")}}var w=new _("#app");class b{listeners={};on(e,t){this.listeners[e]||(this.listeners[e]=[]),this.listeners[e]?.push(t)}off(e,t){if(!this.listeners[e])throw new Error(`Несуществующее событие: ${e}`);this.listeners[e]=this.listeners[e].filter((e=>e!==t))}emit(e,...t){this.listeners[e]&&this.listeners[e].forEach((e=>{e(...t)}))}}function P(e,t){for(const n in t)if(t.hasOwnProperty(n))try{t[n].constructor===Object?t[n]=P(e[n],t[n]):e[n]=t[n]}catch(r){e[n]=t[n]}return e}var k=function(e,t,n){if("object"!=typeof e||null===e)return e;if("string"!=typeof t)throw new Error("path must be string");return P(e,t.split(".").reduceRight(((e,t)=>({[t]:e})),n))};let S;(S||(S={})).Updated="updated";var C=new class extends b{constructor(e){super(),this.state=e}getState(){return this.state}set(e,t){k(this.state,e,t),this.emit(S.Updated,this.state)}}({});class M extends h{constructor(){super("/chats")}update=void 0;create(e){return p(this.http,"",{method:i.POST,retries:1,data:e})}read(e){return p(this.http,"",{method:i.GET,retries:1,data:e})}delete(e){return p(this.http,"",{method:i.DELETE,retries:1,data:e})}addUser(e){return p(this.http,"/users",{method:i.PUT,retries:1,data:e})}deleteUser(e,t){return p(this.http,"/users",{method:i.DELETE,retries:1,data:{users:[e],chatId:t}})}getToken(e){return p(this.http,`/token/${e}`,{method:i.POST,retries:1})}editAvatar(e){return p(this.http,"/avatar",{method:i.PUT,retries:1,data:e})}}let x;var O;(O=x||(x={})).Connected="connected",O.Error="error",O.Message="message",O.Close="close";class E extends b{constructor(e){super(),this.url=e,this.socket=null}connect(){return this.socket=new WebSocket(this.url),this.subscribe(this.socket),new Promise((e=>{this.on(x.Connected,(()=>{this.setupPing(),e()}))}))}send(e){if(!this.socket)throw new Error("Socket is not connected");this.socket.send(JSON.stringify(e))}close(){this.socket?.close()}setupPing(){this.pingInterval=setInterval((()=>this.send({type:"ping"})),5e3),this.on(x.Close,(()=>clearInterval(this.pingInterval)))}subscribe(e){e.addEventListener("open",(()=>{this.emit(x.Connected)})),e.addEventListener("close",(()=>{this.emit(x.Close)})),e.addEventListener("error",(e=>{this.emit(x.Error,e)})),e.addEventListener("message",(e=>{const t=JSON.parse(e.data);(Array.isArray(t)||!t.type||"ping"!==t.type&&"pong"!==t.type)&&this.emit(x.Message,t)}))}}class L{sockets=new Map;static controller=new L;chatsApi=new M;constructor(){return L.controller}static closeAll(){this.controller.sockets.forEach((e=>{e.close()}))}async connect(e,t){if(this.sockets.get(e))return;const n=C.getState().user?.id,r=new E(`${s.WSURL}/${n}/${e}/${t}`);await r.connect(),this.subscribe(r,e),this.sockets.set(e,r)}async sendMessage(e,t){const n={content:t,type:"message"};(await this.getTransport(e)).send(n)}async fetchOldMessages(e,t){const n={type:"get old",content:t};(await this.getTransport(e)).send(n)}onMessage(e,t){if(!Array.isArray(t)&&"message"!==t.type)return;const n=`messages.${e}`,r=C.getState().messages,a=r&&r[e];a?Array.isArray(t)?C.set(n,[...a,...t]):C.set(n,[...a,t]):C.set(n,Array.isArray(t)?t.reverse():[t])}async getTransport(e){const t=this.sockets.get(e);if(!t){const{token:t}=await this.chatsApi.getToken(e);return await this.connect(e,t),this.getTransport(e)}return t}onClose(e){this.sockets.delete(e)}subscribe(e,t){e.on(x.Message,(e=>this.onMessage(t,e))),e.on(x.Close,(()=>this.onClose(t)))}}class A{constructor(){this.api=new d,this.router=new _("#app")}async signUp(e){await this.api.signup(e),await this.getUser(),this.router.replace(f.Profile)}async signIn(e){await this.api.signin(e),await this.getUser(),this.router.replace(f.Chat)}async getUser(){try{const e=await this.api.getUser();e.avatar=s.ResourcesUrl+e.avatar,C.set("user",e);const t=this.router.getCurrentPathName();this.router.replace(""!==t?t:f.Chat)}catch(e){this.router.replace(f.SignInPage),console.error(e)}}async logout(e){try{L.closeAll(),await this.api.logout(),this.router.replace(e??f.SignUpPage),C.set("user",void 0)}catch(e){console.error(e)}}}class I extends h{constructor(){super("/user")}create=void 0;read=void 0;delete=void 0;update(e){return p(this.http,"/profile",{method:i.PUT,retries:1,data:e})}searchUser(e){return p(this.http,"/search",{method:i.POST,retries:1,data:{login:e}})}editPassword(e,t){return p(this.http,"/password",{method:i.PUT,retries:1,data:{oldPassword:e,newPassword:t}})}editAvatar(e){return p(this.http,"/profile/avatar",{method:i.PUT,retries:1,data:e})}}class D{constructor(){this.chatsApi=new M,this.usersApi=new I}async getChats(e){const t=await this.chatsApi.read(e),n=await Promise.all(t.map((async e=>{const t=await this.getToken(e.id);return{...e,token:t,avatar:e.avatar&&s.ResourcesUrl+"/"+e.avatar}})));C.set("chats",n)}async selectChat(e){const t=C.getState().chats?.find((t=>t.id===e));t&&C.set("selectedChat",{avatarSrc:t.avatar,chatName:t.title,id:e})}async createChat(e){await this.chatsApi.create({title:e}),await this.getChats({limit:50,offset:0})}async getToken(e){return(await this.chatsApi.getToken(e)).token}async addUser(e,t){const n=await this.usersApi.searchUser(e);await this.chatsApi.addUser({chatId:t,users:[n[0].id]})}async deleteUser(e,t){const n=await this.usersApi.searchUser(e);await this.chatsApi.deleteUser(n[0].id,t)}async editAvatar(e){const{avatar:t,id:n}=await this.chatsApi.editAvatar(e),r=C.getState().chats?.find((e=>e.id===n)),a=C.getState().chats?.filter((e=>e.id!==n)),l=s.ResourcesUrl+t;if(r&&a){C.set("selectedChat.avatarSrc",l);const e={...r,avatar:l},t=[...a,e];C.set("chats",t)}}}function T(e,t){return class extends e{constructor(e){super({...e,...Object.entries(t).reduce(((e,[t,n])=>(e[t]=n,e)),{})})}}}const F=e=>"object"==typeof e&&null!==e&&e.constructor===Object&&"[object Object]"===Object.prototype.toString.call(e);function B(e){return F(e)||Array.isArray(e)}const j=e=>"number"==typeof e&&isNaN(e),N=(e,t)=>{if(typeof e!=typeof t)return!1;if(void 0===e||void 0===t)return e===t;const n=Object.entries(e),r=Object.entries(t),a=0===n.length,l=0===r.length,s=a&&l;if(!s&&(a||l))return!1;if(s)return!0;if(n.length!==r.length)return!1;let o=!0;return n.forEach((([e,n])=>{if(!(e in t))return void(o=!1);const r=t[e];B(n)&&B(r)?o=N(n,r):n!==r&&(o=j(n)&&j(r))})),o};var R=N;function U(e){return function(t){let n;return class extends t{constructor(t){n=e(C.getState()),super({...t,...n}),C.on(S.Updated,(()=>{const t=e(C.getState());R(n,t)||(n={...t},this.setProps({...t}))}))}}}}let V;var H;(H=V||(V={})).INIT="init",H.FLOW_CDM="flow:component-did-mount",H.FLOW_CDU="flow:component-did-update",H.FLOW_RENDER="flow:render";class W{id=Math.random().toString(16).slice(6);_element=null;constructor(e){this.eventBus=new b,this.registerEvents();const{props:t,children:n}=this.separatePropsFromChildren(e);this.children=n,this.props=this.makePropsProxy(t),this.eventBus.emit(V.INIT)}separatePropsFromChildren(e){const t={},n={};return Object.entries(e).forEach((([e,r])=>{Array.isArray(r)&&r.length>0&&r.every((e=>e instanceof W))||r instanceof W?n[e]=r:t[e]=r})),{props:t,children:n}}_render(){const e=this.render().firstElementChild;this._element&&this._element.replaceWith(e),this._element=e,this.addEvents()}render(){return new DocumentFragment}compile(e,t){const n={...t};Object.entries(this.children).forEach((([e,t])=>{t&&(Array.isArray(t)?n[e]=t.map((e=>`<div data-id="${e.id}"></div>`)):n[e]=`<div data-id="${t.id}"></div>`)}));const r=e(n),a=document.createElement("template");a.innerHTML=r;const l=e=>{const t=a.content.querySelector(`[data-id="${e.id}"]`);t&&(e.getContent()?.append(...Array.from(t.childNodes)),t.replaceWith(e._element))};return Object.entries(this.children).forEach((([e,t])=>{t&&(Array.isArray(t)?t.forEach(l):l(t))})),a.content}getContent(){return this._element}setProps(e){e&&Object.assign(this.props,e)}addEvents(){const{events:e={}}=this.props;Object.keys(e).forEach((t=>{this._element?.addEventListener(t,e[t])}))}makePropsProxy(e){return new Proxy(e,{get(e,t){const n=e[t];return"function"==typeof n?n.bind(e):n},set:(e,t,n)=>{const r={...e};return e[t]=n,this.eventBus.emit(V.FLOW_CDU,r,e),!0},deleteProperty(){throw new Error("Нет прав")}})}_componentDidMount(){this.componentDidMount()}componentDidMount(){}dispatchComponentDidMount(){this.eventBus.emit(V.FLOW_CDM),Object.values(this.children).forEach((e=>{e&&(Array.isArray(e)?e.forEach((e=>e.dispatchComponentDidMount())):e.dispatchComponentDidMount())}))}hide(){}_componentDidUpdate(e,t){this.componentDidUpdate(e,t)&&this.eventBus.emit(V.FLOW_RENDER)}componentDidUpdate(e,t){return!R(e,t)}registerEvents(){this.eventBus.on(V.INIT,this._init.bind(this)),this.eventBus.on(V.FLOW_RENDER,this._render.bind(this)),this.eventBus.on(V.FLOW_CDM,this._componentDidMount.bind(this)),this.eventBus.on(V.FLOW_CDU,this._componentDidUpdate.bind(this))}_init(){this.init(),this.eventBus.emit(V.FLOW_RENDER)}init(){}}var $={};
/**!

 @license
 handlebars v4.7.7

Copyright (C) 2011-2019 by Yehuda Katz

Permission is hereby granted, free of charge, to any person obtaining a copy
of this software and associated documentation files (the "Software"), to deal
in the Software without restriction, including without limitation the rights
to use, copy, modify, merge, publish, distribute, sublicense, and/or sell
copies of the Software, and to permit persons to whom the Software is
furnished to do so, subject to the following conditions:

The above copyright notice and this permission notice shall be included in
all copies or substantial portions of the Software.

THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE
AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,
OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN
THE SOFTWARE.

*/var G=t($=function(){return function(e){var t={};function n(r){if(t[r])return t[r].exports;var a=t[r]={exports:{},id:r,loaded:!1};return e[r].call(a.exports,a,a.exports,n),a.loaded=!0,a.exports}return n.m=e,n.c=t,n.p="",n(0)}([function(e,t,n){var r=n(1).default,a=n(2).default;t.__esModule=!0;var l=r(n(3)),s=a(n(36)),o=a(n(5)),i=r(n(4)),u=r(n(37)),c=a(n(43));function p(){var e=new l.HandlebarsEnvironment;return i.extend(e,l),e.SafeString=s.default,e.Exception=o.default,e.Utils=i,e.escapeExpression=i.escapeExpression,e.VM=u,e.template=function(t){return u.template(t,e)},e}var h=p();h.create=p,c.default(h),h.default=h,t.default=h,e.exports=t.default},function(e,t){t.default=function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n]);return t.default=e,t},t.__esModule=!0},function(e,t){t.default=function(e){return e&&e.__esModule?e:{default:e}},t.__esModule=!0},function(e,t,n){var r=n(2).default;t.__esModule=!0,t.HandlebarsEnvironment=p;var a=n(4),l=r(n(5)),s=n(9),o=n(29),i=r(n(31)),u=n(32);t.VERSION="4.7.7",t.COMPILER_REVISION=8,t.LAST_COMPATIBLE_COMPILER_REVISION=7,t.REVISION_CHANGES={1:"<= 1.0.rc.2",2:"== 1.0.0-rc.3",3:"== 1.0.0-rc.4",4:"== 1.x.x",5:"== 2.0.0-alpha.x",6:">= 2.0.0-beta.1",7:">= 4.0.0 <4.3.0",8:">= 4.3.0"};var c="[object Object]";function p(e,t,n){this.helpers=e||{},this.partials=t||{},this.decorators=n||{},s.registerDefaultHelpers(this),o.registerDefaultDecorators(this)}p.prototype={constructor:p,logger:i.default,log:i.default.log,registerHelper:function(e,t){if(a.toString.call(e)===c){if(t)throw new l.default("Arg not supported with multiple helpers");a.extend(this.helpers,e)}else this.helpers[e]=t},unregisterHelper:function(e){delete this.helpers[e]},registerPartial:function(e,t){if(a.toString.call(e)===c)a.extend(this.partials,e);else{if(void 0===t)throw new l.default('Attempting to register a partial called "'+e+'" as undefined');this.partials[e]=t}},unregisterPartial:function(e){delete this.partials[e]},registerDecorator:function(e,t){if(a.toString.call(e)===c){if(t)throw new l.default("Arg not supported with multiple decorators");a.extend(this.decorators,e)}else this.decorators[e]=t},unregisterDecorator:function(e){delete this.decorators[e]},resetLoggedPropertyAccesses:function(){u.resetLoggedProperties()}};var h=i.default.log;t.log=h,t.createFrame=a.createFrame,t.logger=i.default},function(e,t){t.__esModule=!0,t.extend=s,t.indexOf=function(e,t){for(var n=0,r=e.length;n<r;n++)if(e[n]===t)return n;return-1},t.escapeExpression=function(e){if("string"!=typeof e){if(e&&e.toHTML)return e.toHTML();if(null==e)return"";if(!e)return e+"";e=""+e}return a.test(e)?e.replace(r,l):e},t.isEmpty=function(e){return!e&&0!==e||!(!u(e)||0!==e.length)},t.createFrame=function(e){var t=s({},e);return t._parent=e,t},t.blockParams=function(e,t){return e.path=t,e},t.appendContextPath=function(e,t){return(e?e+".":"")+t};var n={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#x27;","`":"&#x60;","=":"&#x3D;"},r=/[&<>"'`=]/g,a=/[&<>"'`=]/;function l(e){return n[e]}function s(e){for(var t=1;t<arguments.length;t++)for(var n in arguments[t])Object.prototype.hasOwnProperty.call(arguments[t],n)&&(e[n]=arguments[t][n]);return e}var o=Object.prototype.toString;t.toString=o;var i=function(e){return"function"==typeof e};i(/x/)&&(t.isFunction=i=function(e){return"function"==typeof e&&"[object Function]"===o.call(e)}),t.isFunction=i;var u=Array.isArray||function(e){return!(!e||"object"!=typeof e)&&"[object Array]"===o.call(e)};t.isArray=u},function(e,t,n){var r=n(6).default;t.__esModule=!0;var a=["description","fileName","lineNumber","endLineNumber","message","name","number","stack"];function l(e,t){var n=t&&t.loc,s=void 0,o=void 0,i=void 0,u=void 0;n&&(s=n.start.line,o=n.end.line,i=n.start.column,u=n.end.column,e+=" - "+s+":"+i);for(var c=Error.prototype.constructor.call(this,e),p=0;p<a.length;p++)this[a[p]]=c[a[p]];Error.captureStackTrace&&Error.captureStackTrace(this,l);try{n&&(this.lineNumber=s,this.endLineNumber=o,r?(Object.defineProperty(this,"column",{value:i,enumerable:!0}),Object.defineProperty(this,"endColumn",{value:u,enumerable:!0})):(this.column=i,this.endColumn=u))}catch(e){}}l.prototype=new Error,t.default=l,e.exports=t.default},function(e,t,n){e.exports={default:n(7),__esModule:!0}},function(e,t,n){var r=n(8);e.exports=function(e,t,n){return r.setDesc(e,t,n)}},function(e,t){var n=Object;e.exports={create:n.create,getProto:n.getPrototypeOf,isEnum:{}.propertyIsEnumerable,getDesc:n.getOwnPropertyDescriptor,setDesc:n.defineProperty,setDescs:n.defineProperties,getKeys:n.keys,getNames:n.getOwnPropertyNames,getSymbols:n.getOwnPropertySymbols,each:[].forEach}},function(e,t,n){var r=n(2).default;t.__esModule=!0,t.registerDefaultHelpers=function(e){a.default(e),l.default(e),s.default(e),o.default(e),i.default(e),u.default(e),c.default(e)},t.moveHelperToHooks=function(e,t,n){e.helpers[t]&&(e.hooks[t]=e.helpers[t],n||delete e.helpers[t])};var a=r(n(10)),l=r(n(11)),s=r(n(24)),o=r(n(25)),i=r(n(26)),u=r(n(27)),c=r(n(28))},function(e,t,n){t.__esModule=!0;var r=n(4);t.default=function(e){e.registerHelper("blockHelperMissing",(function(t,n){var a=n.inverse,l=n.fn;if(!0===t)return l(this);if(!1===t||null==t)return a(this);if(r.isArray(t))return t.length>0?(n.ids&&(n.ids=[n.name]),e.helpers.each(t,n)):a(this);if(n.data&&n.ids){var s=r.createFrame(n.data);s.contextPath=r.appendContextPath(n.data.contextPath,n.name),n={data:s}}return l(t,n)}))},e.exports=t.default},function(e,t,n){(function(r){var a=n(12).default,l=n(2).default;t.__esModule=!0;var s=n(4),o=l(n(5));t.default=function(e){e.registerHelper("each",(function(e,t){if(!t)throw new o.default("Must pass iterator to #each");var n,l=t.fn,i=t.inverse,u=0,c="",p=void 0,h=void 0;function d(t,n,r){p&&(p.key=t,p.index=n,p.first=0===n,p.last=!!r,h&&(p.contextPath=h+t)),c+=l(e[t],{data:p,blockParams:s.blockParams([e[t],t],[h+t,null])})}if(t.data&&t.ids&&(h=s.appendContextPath(t.data.contextPath,t.ids[0])+"."),s.isFunction(e)&&(e=e.call(this)),t.data&&(p=s.createFrame(t.data)),e&&"object"==typeof e)if(s.isArray(e))for(var m=e.length;u<m;u++)u in e&&d(u,u,u===e.length-1);else if(r.Symbol&&e[r.Symbol.iterator]){for(var f=[],g=e[r.Symbol.iterator](),y=g.next();!y.done;y=g.next())f.push(y.value);for(m=(e=f).length;u<m;u++)d(u,u,u===e.length-1)}else n=void 0,a(e).forEach((function(e){void 0!==n&&d(n,u-1),n=e,u++})),void 0!==n&&d(n,u-1,!0);return 0===u&&(c=i(this)),c}))},e.exports=t.default}).call(t,function(){return this}())},function(e,t,n){e.exports={default:n(13),__esModule:!0}},function(e,t,n){n(14),e.exports=n(20).Object.keys},function(e,t,n){var r=n(15);n(17)("keys",(function(e){return function(t){return e(r(t))}}))},function(e,t,n){var r=n(16);e.exports=function(e){return Object(r(e))}},function(e,t){e.exports=function(e){if(null==e)throw TypeError("Can't call method on  "+e);return e}},function(e,t,n){var r=n(18),a=n(20),l=n(23);e.exports=function(e,t){var n=(a.Object||{})[e]||Object[e],s={};s[e]=t(n),r(r.S+r.F*l((function(){n(1)})),"Object",s)}},function(e,t,n){var r=n(19),a=n(20),l=n(21),s="prototype",o=function(e,t,n){var i,u,c,p=e&o.F,h=e&o.G,d=e&o.S,m=e&o.P,f=e&o.B,g=e&o.W,y=h?a:a[t]||(a[t]={}),v=h?r:d?r[t]:(r[t]||{})[s];for(i in h&&(n=t),n)(u=!p&&v&&i in v)&&i in y||(c=u?v[i]:n[i],y[i]=h&&"function"!=typeof v[i]?n[i]:f&&u?l(c,r):g&&v[i]==c?function(e){var t=function(t){return this instanceof e?new e(t):e(t)};return t[s]=e[s],t}(c):m&&"function"==typeof c?l(Function.call,c):c,m&&((y[s]||(y[s]={}))[i]=c))};o.F=1,o.G=2,o.S=4,o.P=8,o.B=16,o.W=32,e.exports=o},function(e,t){var n=e.exports="undefined"!=typeof window&&window.Math==Math?window:"undefined"!=typeof self&&self.Math==Math?self:Function("return this")();"number"==typeof __g&&(__g=n)},function(e,t){var n=e.exports={version:"1.2.6"};"number"==typeof __e&&(__e=n)},function(e,t,n){var r=n(22);e.exports=function(e,t,n){if(r(e),void 0===t)return e;switch(n){case 1:return function(n){return e.call(t,n)};case 2:return function(n,r){return e.call(t,n,r)};case 3:return function(n,r,a){return e.call(t,n,r,a)}}return function(){return e.apply(t,arguments)}}},function(e,t){e.exports=function(e){if("function"!=typeof e)throw TypeError(e+" is not a function!");return e}},function(e,t){e.exports=function(e){try{return!!e()}catch(e){return!0}}},function(e,t,n){var r=n(2).default;t.__esModule=!0;var a=r(n(5));t.default=function(e){e.registerHelper("helperMissing",(function(){if(1!==arguments.length)throw new a.default('Missing helper: "'+arguments[arguments.length-1].name+'"')}))},e.exports=t.default},function(e,t,n){var r=n(2).default;t.__esModule=!0;var a=n(4),l=r(n(5));t.default=function(e){e.registerHelper("if",(function(e,t){if(2!=arguments.length)throw new l.default("#if requires exactly one argument");return a.isFunction(e)&&(e=e.call(this)),!t.hash.includeZero&&!e||a.isEmpty(e)?t.inverse(this):t.fn(this)})),e.registerHelper("unless",(function(t,n){if(2!=arguments.length)throw new l.default("#unless requires exactly one argument");return e.helpers.if.call(this,t,{fn:n.inverse,inverse:n.fn,hash:n.hash})}))},e.exports=t.default},function(e,t){t.__esModule=!0,t.default=function(e){e.registerHelper("log",(function(){for(var t=[void 0],n=arguments[arguments.length-1],r=0;r<arguments.length-1;r++)t.push(arguments[r]);var a=1;null!=n.hash.level?a=n.hash.level:n.data&&null!=n.data.level&&(a=n.data.level),t[0]=a,e.log.apply(e,t)}))},e.exports=t.default},function(e,t){t.__esModule=!0,t.default=function(e){e.registerHelper("lookup",(function(e,t,n){return e?n.lookupProperty(e,t):e}))},e.exports=t.default},function(e,t,n){var r=n(2).default;t.__esModule=!0;var a=n(4),l=r(n(5));t.default=function(e){e.registerHelper("with",(function(e,t){if(2!=arguments.length)throw new l.default("#with requires exactly one argument");a.isFunction(e)&&(e=e.call(this));var n=t.fn;if(a.isEmpty(e))return t.inverse(this);var r=t.data;return t.data&&t.ids&&((r=a.createFrame(t.data)).contextPath=a.appendContextPath(t.data.contextPath,t.ids[0])),n(e,{data:r,blockParams:a.blockParams([e],[r&&r.contextPath])})}))},e.exports=t.default},function(e,t,n){var r=n(2).default;t.__esModule=!0,t.registerDefaultDecorators=function(e){a.default(e)};var a=r(n(30))},function(e,t,n){t.__esModule=!0;var r=n(4);t.default=function(e){e.registerDecorator("inline",(function(e,t,n,a){var l=e;return t.partials||(t.partials={},l=function(a,l){var s=n.partials;n.partials=r.extend({},s,t.partials);var o=e(a,l);return n.partials=s,o}),t.partials[a.args[0]]=a.fn,l}))},e.exports=t.default},function(e,t,n){t.__esModule=!0;var r=n(4),a={methodMap:["debug","info","warn","error"],level:"info",lookupLevel:function(e){if("string"==typeof e){var t=r.indexOf(a.methodMap,e.toLowerCase());e=t>=0?t:parseInt(e,10)}return e},log:function(e){if(e=a.lookupLevel(e),"undefined"!=typeof console&&a.lookupLevel(a.level)<=e){var t=a.methodMap[e];console[t]||(t="log");for(var n=arguments.length,r=Array(n>1?n-1:0),l=1;l<n;l++)r[l-1]=arguments[l];console[t].apply(console,r)}}};t.default=a,e.exports=t.default},function(e,t,n){var r=n(33).default,a=n(12).default,l=n(1).default;t.__esModule=!0,t.createProtoAccessControl=function(e){var t=r(null);t.constructor=!1,t.__defineGetter__=!1,t.__defineSetter__=!1,t.__lookupGetter__=!1;var n=r(null);return n.__proto__=!1,{properties:{whitelist:s.createNewLookupObject(n,e.allowedProtoProperties),defaultValue:e.allowProtoPropertiesByDefault},methods:{whitelist:s.createNewLookupObject(t,e.allowedProtoMethods),defaultValue:e.allowProtoMethodsByDefault}}},t.resultIsAllowed=function(e,t,n){return u("function"==typeof e?t.methods:t.properties,n)},t.resetLoggedProperties=function(){a(i).forEach((function(e){delete i[e]}))};var s=n(35),o=l(n(31)),i=r(null);function u(e,t){return void 0!==e.whitelist[t]?!0===e.whitelist[t]:void 0!==e.defaultValue?e.defaultValue:(function(e){!0!==i[e]&&(i[e]=!0,o.log("error",'Handlebars: Access has been denied to resolve the property "'+e+'" because it is not an "own property" of its parent.\nYou can add a runtime option to disable the check or this warning:\nSee https://handlebarsjs.com/api-reference/runtime-options.html#options-to-control-prototype-access for details'))}(t),!1)}},function(e,t,n){e.exports={default:n(34),__esModule:!0}},function(e,t,n){var r=n(8);e.exports=function(e,t){return r.create(e,t)}},function(e,t,n){var r=n(33).default;t.__esModule=!0,t.createNewLookupObject=function(){for(var e=arguments.length,t=Array(e),n=0;n<e;n++)t[n]=arguments[n];return a.extend.apply(void 0,[r(null)].concat(t))};var a=n(4)},function(e,t){function n(e){this.string=e}t.__esModule=!0,n.prototype.toString=n.prototype.toHTML=function(){return""+this.string},t.default=n,e.exports=t.default},function(e,t,n){var r=n(38).default,a=n(12).default,l=n(1).default,s=n(2).default;t.__esModule=!0,t.checkRevision=function(e){var t=e&&e[0]||1,n=u.COMPILER_REVISION;if(!(t>=u.LAST_COMPATIBLE_COMPILER_REVISION&&t<=u.COMPILER_REVISION)){if(t<u.LAST_COMPATIBLE_COMPILER_REVISION){var r=u.REVISION_CHANGES[n],a=u.REVISION_CHANGES[t];throw new i.default("Template was precompiled with an older version of Handlebars than the current runtime. Please update your precompiler to a newer version ("+r+") or downgrade your runtime to an older version ("+a+").")}throw new i.default("Template was precompiled with a newer version of Handlebars than the current runtime. Please update your runtime to a newer version ("+e[1]+").")}},t.template=function(e,t){if(!t)throw new i.default("No environment passed to template");if(!e||!e.main)throw new i.default("Unknown template object: "+typeof e);e.main.decorator=e.main_d,t.VM.checkRevision(e.compiler);var n=e.compiler&&7===e.compiler[0],l={strict:function(e,t,n){if(!e||!(t in e))throw new i.default('"'+t+'" not defined in '+e,{loc:n});return l.lookupProperty(e,t)},lookupProperty:function(e,t){var n=e[t];return null==n||Object.prototype.hasOwnProperty.call(e,t)||h.resultIsAllowed(n,l.protoAccessControl,t)?n:void 0},lookup:function(e,t){for(var n=e.length,r=0;r<n;r++)if(null!=(e[r]&&l.lookupProperty(e[r],t)))return e[r][t]},lambda:function(e,t){return"function"==typeof e?e.call(t):e},escapeExpression:o.escapeExpression,invokePartial:function(n,r,a){a.hash&&(r=o.extend({},r,a.hash),a.ids&&(a.ids[0]=!0)),n=t.VM.resolvePartial.call(this,n,r,a);var l=o.extend({},a,{hooks:this.hooks,protoAccessControl:this.protoAccessControl}),s=t.VM.invokePartial.call(this,n,r,l);if(null==s&&t.compile&&(a.partials[a.name]=t.compile(n,e.compilerOptions,t),s=a.partials[a.name](r,l)),null!=s){if(a.indent){for(var u=s.split("\n"),c=0,p=u.length;c<p&&(u[c]||c+1!==p);c++)u[c]=a.indent+u[c];s=u.join("\n")}return s}throw new i.default("The partial "+a.name+" could not be compiled when running in runtime-only mode")},fn:function(t){var n=e[t];return n.decorator=e[t+"_d"],n},programs:[],program:function(e,t,n,r,a){var l=this.programs[e],s=this.fn(e);return t||a||r||n?l=d(this,e,s,t,n,r,a):l||(l=this.programs[e]=d(this,e,s)),l},data:function(e,t){for(;e&&t--;)e=e._parent;return e},mergeIfNeeded:function(e,t){var n=e||t;return e&&t&&e!==t&&(n=o.extend({},t,e)),n},nullContext:r({}),noop:t.VM.noop,compilerInfo:e.compiler};function s(t){var n=arguments.length<=1||void 0===arguments[1]?{}:arguments[1],r=n.data;s._setup(n),!n.partial&&e.useData&&(r=function(e,t){return t&&"root"in t||((t=t?u.createFrame(t):{}).root=e),t}(t,r));var a=void 0,o=e.useBlockParams?[]:void 0;function i(t){return""+e.main(l,t,l.helpers,l.partials,r,o,a)}return e.useDepths&&(a=n.depths?t!=n.depths[0]?[t].concat(n.depths):n.depths:[t]),(i=f(e.main,i,l,n.depths||[],r,o))(t,n)}return s.isTop=!0,s._setup=function(r){if(r.partial)l.protoAccessControl=r.protoAccessControl,l.helpers=r.helpers,l.partials=r.partials,l.decorators=r.decorators,l.hooks=r.hooks;else{var s=o.extend({},t.helpers,r.helpers);!function(e,t){a(e).forEach((function(n){var r=e[n];e[n]=function(e,t){var n=t.lookupProperty;return p.wrapHelper(e,(function(e){return o.extend({lookupProperty:n},e)}))}(r,t)}))}(s,l),l.helpers=s,e.usePartial&&(l.partials=l.mergeIfNeeded(r.partials,t.partials)),(e.usePartial||e.useDecorators)&&(l.decorators=o.extend({},t.decorators,r.decorators)),l.hooks={},l.protoAccessControl=h.createProtoAccessControl(r);var i=r.allowCallsToHelperMissing||n;c.moveHelperToHooks(l,"helperMissing",i),c.moveHelperToHooks(l,"blockHelperMissing",i)}},s._child=function(t,n,r,a){if(e.useBlockParams&&!r)throw new i.default("must pass block params");if(e.useDepths&&!a)throw new i.default("must pass parent depths");return d(l,t,e[t],n,0,r,a)},s},t.wrapProgram=d,t.resolvePartial=function(e,t,n){return e?e.call||n.name||(n.name=e,e=n.partials[e]):e="@partial-block"===n.name?n.data["partial-block"]:n.partials[n.name],e},t.invokePartial=function(e,t,n){var r=n.data&&n.data["partial-block"];n.partial=!0,n.ids&&(n.data.contextPath=n.ids[0]||n.data.contextPath);var a=void 0;if(n.fn&&n.fn!==m&&function(){n.data=u.createFrame(n.data);var e=n.fn;a=n.data["partial-block"]=function(t){var n=arguments.length<=1||void 0===arguments[1]?{}:arguments[1];return n.data=u.createFrame(n.data),n.data["partial-block"]=r,e(t,n)},e.partials&&(n.partials=o.extend({},n.partials,e.partials))}(),void 0===e&&a&&(e=a),void 0===e)throw new i.default("The partial "+n.name+" could not be found");if(e instanceof Function)return e(t,n)},t.noop=m;var o=l(n(4)),i=s(n(5)),u=n(3),c=n(9),p=n(42),h=n(32);function d(e,t,n,r,a,l,s){function o(t){var a=arguments.length<=1||void 0===arguments[1]?{}:arguments[1],o=s;return!s||t==s[0]||t===e.nullContext&&null===s[0]||(o=[t].concat(s)),n(e,t,e.helpers,e.partials,a.data||r,l&&[a.blockParams].concat(l),o)}return(o=f(n,o,e,s,r,l)).program=t,o.depth=s?s.length:0,o.blockParams=a||0,o}function m(){return""}function f(e,t,n,r,a,l){if(e.decorator){var s={};t=e.decorator(t,s,n,r&&r[0],a,l,r),o.extend(t,s)}return t}},function(e,t,n){e.exports={default:n(39),__esModule:!0}},function(e,t,n){n(40),e.exports=n(20).Object.seal},function(e,t,n){var r=n(41);n(17)("seal",(function(e){return function(t){return e&&r(t)?e(t):t}}))},function(e,t){e.exports=function(e){return"object"==typeof e?null!==e:"function"==typeof e}},function(e,t){t.__esModule=!0,t.wrapHelper=function(e,t){return"function"!=typeof e?e:function(){return arguments[arguments.length-1]=t(arguments[arguments.length-1]),e.apply(this,arguments)}}},function(e,t){(function(n){t.__esModule=!0,t.default=function(e){var t=void 0!==n?n:window,r=t.Handlebars;e.noConflict=function(){return t.Handlebars===e&&(t.Handlebars=r),e}},e.exports=t.default}).call(t,function(){return this}())}])}()).template({1:function(e,t,n,r,a){var l,s,o=null!=t?t:e.nullContext||{},i=e.hooks.helperMissing,u="function",c=e.escapeExpression,p=e.lookupProperty||function(e,t){if(Object.prototype.hasOwnProperty.call(e,t))return e[t]};return"  <button type='"+c(typeof(s=null!=(s=p(n,"type")||(null!=t?p(t,"type"):t))?s:i)===u?s.call(o,{name:"type",hash:{},data:a,loc:{start:{line:2,column:16},end:{line:2,column:24}}}):s)+"' class='button__button button__button_type_"+c(typeof(s=null!=(s=p(n,"stylesType")||(null!=t?p(t,"stylesType"):t))?s:i)===u?s.call(o,{name:"stylesType",hash:{},data:a,loc:{start:{line:2,column:68},end:{line:2,column:82}}}):s)+" "+c(typeof(s=null!=(s=p(n,"styles")||(null!=t?p(t,"styles"):t))?s:i)===u?s.call(o,{name:"styles",hash:{},data:a,loc:{start:{line:2,column:83},end:{line:2,column:93}}}):s)+"'>\r\n    "+c(typeof(s=null!=(s=p(n,"label")||(null!=t?p(t,"label"):t))?s:i)===u?s.call(o,{name:"label",hash:{},data:a,loc:{start:{line:3,column:4},end:{line:3,column:13}}}):s)+"\r\n    "+(null!=(l=typeof(s=null!=(s=p(n,"child")||(null!=t?p(t,"child"):t))?s:i)===u?s.call(o,{name:"child",hash:{},data:a,loc:{start:{line:4,column:4},end:{line:4,column:15}}}):s)?l:"")+"\r\n  </button>\r\n"},3:function(e,t,n,r,a){var l,s,o=null!=t?t:e.nullContext||{},i=e.hooks.helperMissing,u="function",c=e.escapeExpression,p=e.lookupProperty||function(e,t){if(Object.prototype.hasOwnProperty.call(e,t))return e[t]};return"  <div class='button "+c(typeof(s=null!=(s=p(n,"containerStyles")||(null!=t?p(t,"containerStyles"):t))?s:i)===u?s.call(o,{name:"containerStyles",hash:{},data:a,loc:{start:{line:7,column:21},end:{line:7,column:40}}}):s)+"'>\r\n"+(null!=(l=p(n,"if").call(o,null!=t?p(t,"actionError"):t,{name:"if",hash:{},fn:e.program(4,a,0),inverse:e.noop,data:a,loc:{start:{line:8,column:4},end:{line:10,column:11}}}))?l:"")+"    <button\r\n      type='"+c(typeof(s=null!=(s=p(n,"type")||(null!=t?p(t,"type"):t))?s:i)===u?s.call(o,{name:"type",hash:{},data:a,loc:{start:{line:12,column:12},end:{line:12,column:20}}}):s)+"'\r\n      class='button__button button__button_type_"+c(typeof(s=null!=(s=p(n,"stylesType")||(null!=t?p(t,"stylesType"):t))?s:i)===u?s.call(o,{name:"stylesType",hash:{},data:a,loc:{start:{line:13,column:48},end:{line:13,column:62}}}):s)+" "+c(typeof(s=null!=(s=p(n,"styles")||(null!=t?p(t,"styles"):t))?s:i)===u?s.call(o,{name:"styles",hash:{},data:a,loc:{start:{line:13,column:63},end:{line:13,column:73}}}):s)+"'\r\n    >"+c(typeof(s=null!=(s=p(n,"label")||(null!=t?p(t,"label"):t))?s:i)===u?s.call(o,{name:"label",hash:{},data:a,loc:{start:{line:14,column:5},end:{line:14,column:14}}}):s)+"</button>\r\n"+(null!=(l=p(n,"if").call(o,null!=t?p(t,"validationError"):t,{name:"if",hash:{},fn:e.program(6,a,0),inverse:e.noop,data:a,loc:{start:{line:15,column:4},end:{line:17,column:11}}}))?l:"")+"  </div>\r\n"},4:function(e,t,n,r,a){var l,s=e.lookupProperty||function(e,t){if(Object.prototype.hasOwnProperty.call(e,t))return e[t]};return"      <p class='button__error'>"+e.escapeExpression("function"==typeof(l=null!=(l=s(n,"actionError")||(null!=t?s(t,"actionError"):t))?l:e.hooks.helperMissing)?l.call(null!=t?t:e.nullContext||{},{name:"actionError",hash:{},data:a,loc:{start:{line:9,column:31},end:{line:9,column:46}}}):l)+"</p>\r\n"},6:function(e,t,n,r,a){var l,s=e.lookupProperty||function(e,t){if(Object.prototype.hasOwnProperty.call(e,t))return e[t]};return"      <p class='button__error'>"+e.escapeExpression("function"==typeof(l=null!=(l=s(n,"validationError")||(null!=t?s(t,"validationError"):t))?l:e.hooks.helperMissing)?l.call(null!=t?t:e.nullContext||{},{name:"validationError",hash:{},data:a,loc:{start:{line:16,column:31},end:{line:16,column:50}}}):l)+"</p>\r\n"},compiler:[8,">= 4.3.0"],main:function(e,t,n,r,a){var l,s=e.lookupProperty||function(e,t){if(Object.prototype.hasOwnProperty.call(e,t))return e[t]};return null!=(l=s(n,"if").call(null!=t?t:e.nullContext||{},null!=t?s(t,"noValidation"):t,{name:"if",hash:{},fn:e.program(1,a,0),inverse:e.program(3,a,0),data:a,loc:{start:{line:1,column:0},end:{line:19,column:7}}}))?l:""},useData:!0});let q;var Z;(Z=q||(q={})).Submit="submit",Z.Attachment="attachment",Z.Custom="custom";class z extends W{constructor(e){super(e)}render(){return this.compile(G,this.props)}}var J=t($).template({compiler:[8,">= 4.3.0"],main:function(e,t,n,r,a){var l,s,o=null!=t?t:e.nullContext||{},i=e.hooks.helperMissing,u="function",c=e.escapeExpression,p=e.lookupProperty||function(e,t){if(Object.prototype.hasOwnProperty.call(e,t))return e[t]};return"<div class='inputField "+c(typeof(s=null!=(s=p(n,"inputWrapperStyle")||(null!=t?p(t,"inputWrapperStyle"):t))?s:i)===u?s.call(o,{name:"inputWrapperStyle",hash:{},data:a,loc:{start:{line:1,column:23},end:{line:1,column:44}}}):s)+"'>\r\n  <label for="+c(typeof(s=null!=(s=p(n,"name")||(null!=t?p(t,"name"):t))?s:i)===u?s.call(o,{name:"name",hash:{},data:a,loc:{start:{line:2,column:13},end:{line:2,column:21}}}):s)+" class='inputField__label "+c(typeof(s=null!=(s=p(n,"labelStyle")||(null!=t?p(t,"labelStyle"):t))?s:i)===u?s.call(o,{name:"labelStyle",hash:{},data:a,loc:{start:{line:2,column:47},end:{line:2,column:61}}}):s)+"'>"+c(typeof(s=null!=(s=p(n,"label")||(null!=t?p(t,"label"):t))?s:i)===u?s.call(o,{name:"label",hash:{},data:a,loc:{start:{line:2,column:63},end:{line:2,column:72}}}):s)+"</label>\r\n  "+(null!=(l=typeof(s=null!=(s=p(n,"input")||(null!=t?p(t,"input"):t))?s:i)===u?s.call(o,{name:"input",hash:{},data:a,loc:{start:{line:3,column:2},end:{line:3,column:13}}}):s)?l:"")+"\r\n  <p class='inputField__error "+c(typeof(s=null!=(s=p(n,"errorStyle")||(null!=t?p(t,"errorStyle"):t))?s:i)===u?s.call(o,{name:"errorStyle",hash:{},data:a,loc:{start:{line:4,column:30},end:{line:4,column:44}}}):s)+"'>"+c(typeof(s=null!=(s=p(n,"errorText")||(null!=t?p(t,"errorText"):t))?s:i)===u?s.call(o,{name:"errorText",hash:{},data:a,loc:{start:{line:4,column:46},end:{line:4,column:59}}}):s)+"</p>\r\n</div>"},useData:!0});class K extends W{constructor(e){super(e)}render(){return this.compile(J,this.props)}}var X=t($).template({1:function(e,t,n,r,a){var l;return"    "+(null!=(l=e.lambda(t,t))?l:"")+"\r\n"},compiler:[8,">= 4.3.0"],main:function(e,t,n,r,a){var l,s,o=null!=t?t:e.nullContext||{},i=e.hooks.helperMissing,u="function",c=e.lookupProperty||function(e,t){if(Object.prototype.hasOwnProperty.call(e,t))return e[t]};return"<form action='submit' class='"+e.escapeExpression(typeof(s=null!=(s=c(n,"formClass")||(null!=t?c(t,"formClass"):t))?s:i)===u?s.call(o,{name:"formClass",hash:{},data:a,loc:{start:{line:1,column:29},end:{line:1,column:42}}}):s)+"' novalidate>\r\n"+(null!=(l=c(n,"each").call(o,null!=t?c(t,"fields"):t,{name:"each",hash:{},fn:e.program(1,a,0),inverse:e.noop,data:a,loc:{start:{line:2,column:2},end:{line:4,column:11}}}))?l:"")+"  "+(null!=(l=typeof(s=null!=(s=c(n,"submitBtn")||(null!=t?c(t,"submitBtn"):t))?s:i)===u?s.call(o,{name:"submitBtn",hash:{},data:a,loc:{start:{line:5,column:2},end:{line:5,column:17}}}):s)?l:"")+"\r\n  "+(null!=(l=typeof(s=null!=(s=c(n,"Modal")||(null!=t?c(t,"Modal"):t))?s:i)===u?s.call(o,{name:"Modal",hash:{},data:a,loc:{start:{line:6,column:2},end:{line:6,column:13}}}):s)?l:"")+"\r\n</form>"},useData:!0});class Y extends W{constructor(e){super(e)}getValues(){const e={};return this.children.inputs.forEach((t=>{const n=t.props.name;e[n]=t.file})),e}componentDidMount(){this.props.events={submit:e=>{e.preventDefault(),this.props.submit(this.getValues()),this.props.shouldCleanOnSubmit&&this.cleanValues()}},this.props.validationRules}cleanValues(){this.children.inputs.forEach((e=>{e.props.value=""}))}render(){return this.compile(X,this.props)}}class Q extends W{constructor(e){super(e),this.props.validationRules&&(this.validationBus=new b)}getValues(){const e={};return this.children.inputs.forEach((t=>{const n=t.getContent(),r=n.name;e[r]=n.value})),e}componentDidMount(){this.props.events={submit:e=>{if(e.preventDefault(),this.validationBus){this.triggerFormValidation();if(this.children.fields.some((e=>e.props.errorText&&""!==e.props.errorText)))return}this.props.submit(this.getValues()),this.props.shouldCleanOnSubmit&&this.cleanValues()}},this.subscribeInputsToValidationBus(),this.props.validationRules}subscribeInputsToValidationBus(){if(this.validationBus){this.children.inputs.forEach((e=>{const t=e.props.name;e.props.events={blur:n=>{this.triggerInputValidation(t,e.value)}},this.validationBus?.on(t,(e=>this.validationListener(e,t)))}))}}triggerInputValidation(e,t){this.validationBus&&this.validationBus.emit(e,t)}triggerFormValidation(){this.children.inputs.forEach((e=>{if(this.validationBus){const t=e.props.name;this.validationBus.emit(t,e.value)}}))}validationListener(e,t){const n=this.props.validationRules&&this.props.validationRules[t];if(n){const r=n(e),a=this.children.fields.filter((e=>e.props.name===t));if(!a[0])throw new Error(`Поле с имененм ${t} не зарегистрировано`);if(a.length>1)throw new Error("Имена полей ввода должны быть уникальными");const l=a[0];null!==r&&(l.props.errorText=r),null===r&&l.props.errorText&&(l.props.errorText="")}}cleanValues(){this.children.inputs.forEach((e=>{e.props.value=""}))}render(){return this.compile(X,this.props)}}var ee=t($).template({1:function(e,t,n,r,a){var l,s,o=null!=t?t:e.nullContext||{},i=e.hooks.helperMissing,u="function",c=e.escapeExpression,p=e.lookupProperty||function(e,t){if(Object.prototype.hasOwnProperty.call(e,t))return e[t]};return"<textarea "+(null!=(l=p(n,"if").call(o,null!=t?p(t,"value"):t,{name:"if",hash:{},fn:e.program(2,a,0),inverse:e.noop,data:a,loc:{start:{line:2,column:10},end:{line:2,column:45}}}))?l:"")+' class="'+c(typeof(s=null!=(s=p(n,"inputStyle")||(null!=t?p(t,"inputStyle"):t))?s:i)===u?s.call(o,{name:"inputStyle",hash:{},data:a,loc:{start:{line:2,column:53},end:{line:2,column:67}}}):s)+'" name='+c(typeof(s=null!=(s=p(n,"name")||(null!=t?p(t,"name"):t))?s:i)===u?s.call(o,{name:"name",hash:{},data:a,loc:{start:{line:2,column:74},end:{line:2,column:82}}}):s)+" placeholder="+c(typeof(s=null!=(s=p(n,"placeholder")||(null!=t?p(t,"placeholder"):t))?s:i)===u?s.call(o,{name:"placeholder",hash:{},data:a,loc:{start:{line:2,column:95},end:{line:2,column:110}}}):s)+">\r\n"},2:function(e,t,n,r,a){var l,s=e.lookupProperty||function(e,t){if(Object.prototype.hasOwnProperty.call(e,t))return e[t]};return"value="+e.escapeExpression("function"==typeof(l=null!=(l=s(n,"value")||(null!=t?s(t,"value"):t))?l:e.hooks.helperMissing)?l.call(null!=t?t:e.nullContext||{},{name:"value",hash:{},data:a,loc:{start:{line:2,column:29},end:{line:2,column:38}}}):l)},4:function(e,t,n,r,a){var l,s,o=null!=t?t:e.nullContext||{},i=e.hooks.helperMissing,u="function",c=e.escapeExpression,p=e.lookupProperty||function(e,t){if(Object.prototype.hasOwnProperty.call(e,t))return e[t]};return'<input type="'+c(typeof(s=null!=(s=p(n,"type")||(null!=t?p(t,"type"):t))?s:i)===u?s.call(o,{name:"type",hash:{},data:a,loc:{start:{line:4,column:13},end:{line:4,column:21}}}):s)+'" '+(null!=(l=p(n,"if").call(o,null!=t?p(t,"value"):t,{name:"if",hash:{},fn:e.program(2,a,0),inverse:e.noop,data:a,loc:{start:{line:4,column:23},end:{line:4,column:58}}}))?l:"")+' class="'+c(typeof(s=null!=(s=p(n,"inputStyle")||(null!=t?p(t,"inputStyle"):t))?s:i)===u?s.call(o,{name:"inputStyle",hash:{},data:a,loc:{start:{line:4,column:66},end:{line:4,column:80}}}):s)+'" name='+c(typeof(s=null!=(s=p(n,"name")||(null!=t?p(t,"name"):t))?s:i)===u?s.call(o,{name:"name",hash:{},data:a,loc:{start:{line:4,column:87},end:{line:4,column:95}}}):s)+" "+(null!=(l=p(n,"if").call(o,null!=t?p(t,"id"):t,{name:"if",hash:{},fn:e.program(5,a,0),inverse:e.noop,data:a,loc:{start:{line:4,column:96},end:{line:4,column:122}}}))?l:"")+">\r\n"},5:function(e,t,n,r,a){var l,s=e.lookupProperty||function(e,t){if(Object.prototype.hasOwnProperty.call(e,t))return e[t]};return"id="+e.escapeExpression("function"==typeof(l=null!=(l=s(n,"id")||(null!=t?s(t,"id"):t))?l:e.hooks.helperMissing)?l.call(null!=t?t:e.nullContext||{},{name:"id",hash:{},data:a,loc:{start:{line:4,column:109},end:{line:4,column:115}}}):l)},compiler:[8,">= 4.3.0"],main:function(e,t,n,r,a){var l,s=e.lookupProperty||function(e,t){if(Object.prototype.hasOwnProperty.call(e,t))return e[t]};return null!=(l=s(n,"if").call(null!=t?t:e.nullContext||{},null!=t?s(t,"isTextArea"):t,{name:"if",hash:{},fn:e.program(1,a,0),inverse:e.program(4,a,0),data:a,loc:{start:{line:1,column:0},end:{line:5,column:7}}}))?l:""},useData:!0});class te extends W{constructor(e){super(e)}get file(){const e=this.getContent();return e.files&&e.files[0]}render(){return this.compile(ee,this.props)}}class ne extends W{constructor(e){super(e)}get value(){return this.getContent().value}render(){return this.compile(ee,this.props)}}var re=t($).template({1:function(e,t,n,r,a){var l;return"      "+(null!=(l=e.lambda(t,t))?l:"")+"\r\n"},compiler:[8,">= 4.3.0"],main:function(e,t,n,r,a){var l,s,o=null!=t?t:e.nullContext||{},i=e.hooks.helperMissing,u="function",c=e.lookupProperty||function(e,t){if(Object.prototype.hasOwnProperty.call(e,t))return e[t]};return"<div class='modalBackground'>\r\n  "+(null!=(l=typeof(s=null!=(s=c(n,"CloseBtn")||(null!=t?c(t,"CloseBtn"):t))?s:i)===u?s.call(o,{name:"CloseBtn",hash:{},data:a,loc:{start:{line:2,column:2},end:{line:2,column:16}}}):s)?l:"")+"\r\n  <div class='modal'>\r\n    <h3 class='modal__header'>"+e.escapeExpression(typeof(s=null!=(s=c(n,"header")||(null!=t?c(t,"header"):t))?s:i)===u?s.call(o,{name:"header",hash:{},data:a,loc:{start:{line:4,column:30},end:{line:4,column:40}}}):s)+"</h3>\r\n"+(null!=(l=c(n,"each").call(o,null!=t?c(t,"content"):t,{name:"each",hash:{},fn:e.program(1,a,0),inverse:e.noop,data:a,loc:{start:{line:5,column:4},end:{line:7,column:13}}}))?l:"")+"  </div>\r\n</div>"},useData:!0});class ae extends W{constructor(e){super(e)}init(){this.children.CloseBtn=new z({label:"",noValidation:!0,styles:"closeBtn",events:{click:this.props.onClose}})}render(){return this.compile(re,this.props)}}const le=(e,t,n,r)=>{const a=new ne({name:"login",inputStyle:"inputField__input"}),l=new K({input:a,label:"Логин",name:"login"}),s=new Q({fields:[l],inputs:[a],submitBtn:new z({label:"Добавить пользователя",stylesType:q.Submit}),submit:async({login:r})=>{await n.addUser(r,t),e()}}),o=new Q({fields:[l],inputs:[a],submitBtn:new z({label:"Удалить пользователя",stylesType:q.Submit}),submit:async({login:r})=>{await n.deleteUser(r,t),e()}}),i=new te({type:"file",name:"avatar",id:"avatar",inputStyle:"modal__fileInput"}),u=new K({input:i,label:"Выберите файл",name:"avatar",labelStyle:"modal__fileInputLabel"}),c=new Y({fields:[u],inputs:[i],submit:async({avatar:r})=>{if(r){const e=new FormData;e.append("avatar",r),e.append("chatId",t.toString()),await n.editAvatar(e)}e()},submitBtn:new z({label:"Поменять аватар",stylesType:q.Submit}),formClass:"modal__fileForm"}),p=new ne({name:"chatName",inputStyle:"inputField__input"}),h=new K({input:p,label:"Имя чата",name:"chatName"}),d=new Q({fields:[h],inputs:[p],submit:async({chatName:t})=>{await n.createChat(t),e()},submitBtn:new z({label:"Создать чат",stylesType:q.Submit}),formClass:"modal__fileForm"});switch(r){case"delete-chat":return new ae({isOpen:!0,content:[new z({label:"Подтвердить",stylesType:q.Submit})],header:"Удалить?",onClose:e});case"add-user":return new ae({isOpen:!0,header:"Добавить пользователя",content:[s],onClose:e});case"delete-user":return new ae({isOpen:!0,header:"Удалить пользователя",content:[o],onClose:e});case"change-avatar":return new ae({isOpen:!0,header:"Поменять аватар",content:[c],onClose:e});case"create-chat":return new ae({isOpen:!0,header:"Создать чат",content:[d],onClose:e});default:return}};var se;se=new URL(l("27Lyk").resolve("hI5MR"),import.meta.url).toString();var oe=t($).template({1:function(e,t,n,r,a){return'        class="chatMessage chatMessage_type_receivedMessage"\r\n'},3:function(e,t,n,r,a){var l,s=e.lookupProperty||function(e,t){if(Object.prototype.hasOwnProperty.call(e,t))return e[t]};return'        <p class="chatMessage__date">'+e.escapeExpression("function"==typeof(l=null!=(l=s(n,"messageDate")||(null!=t?s(t,"messageDate"):t))?l:e.hooks.helperMissing)?l.call(null!=t?t:e.nullContext||{},{name:"messageDate",hash:{},data:a,loc:{start:{line:8,column:37},end:{line:8,column:52}}}):l)+"</p>\r\n"},5:function(e,t,n,r,a){var l,s=e.lookupProperty||function(e,t){if(Object.prototype.hasOwnProperty.call(e,t))return e[t]};return null!=(l=s(n,"if").call(null!=t?t:e.nullContext||{},null!=t?s(t,"isMessageSent"):t,{name:"if",hash:{},fn:e.program(6,a,0),inverse:e.noop,data:a,loc:{start:{line:12,column:12},end:{line:14,column:19}}}))?l:""},6:function(e,t,n,r,a){return'                class="chatMessage__content chatMessage__content_isMessageSent chatMessage__content_type_img"\r\n'},8:function(e,t,n,r,a){return'            class="chatMessage__content chatMessage__content_type_img"\r\n'},10:function(e,t,n,r,a){return'            class="chatMessage__content chatMessage__content_isMessageSent"\r\n'},12:function(e,t,n,r,a){var l,s=e.lookupProperty||function(e,t){if(Object.prototype.hasOwnProperty.call(e,t))return e[t]};return'        <p class="chatMessage__text">\r\n            '+e.escapeExpression("function"==typeof(l=null!=(l=s(n,"textMessage")||(null!=t?s(t,"textMessage"):t))?l:e.hooks.helperMissing)?l.call(null!=t?t:e.nullContext||{},{name:"textMessage",hash:{},data:a,loc:{start:{line:26,column:12},end:{line:26,column:27}}}):l)+"\r\n        </p>\r\n"},14:function(e,t,n,r,a){var l,s=e.lookupProperty||function(e,t){if(Object.prototype.hasOwnProperty.call(e,t))return e[t]};return"            <img\r\n                src="+e.escapeExpression("function"==typeof(l=null!=(l=s(n,"imgPath")||(null!=t?s(t,"imgPath"):t))?l:e.hooks.helperMissing)?l.call(null!=t?t:e.nullContext||{},{name:"imgPath",hash:{},data:a,loc:{start:{line:31,column:20},end:{line:31,column:31}}}):l)+'\r\n                alt="Изображение в сообщении"\r\n                class="chatMessage__imgMessage"\r\n            >\r\n'},16:function(e,t,n,r,a){return'                class="chatMessage__time chatMessage__time_messageContent_img"\r\n'},18:function(e,t,n,r,a){var l,s=e.lookupProperty||function(e,t){if(Object.prototype.hasOwnProperty.call(e,t))return e[t]};return null!=(l=s(n,"if").call(null!=t?t:e.nullContext||{},null!=t?s(t,"isMessageDelivered"):t,{name:"if",hash:{},fn:e.program(19,a,0),inverse:e.noop,data:a,loc:{start:{line:43,column:14},end:{line:49,column:21}}}))?l:""},19:function(e,t,n,r,a){var l,s=e.lookupProperty||function(e,t){if(Object.prototype.hasOwnProperty.call(e,t))return e[t]};return"                <img\r\n                    src="+e.escapeExpression("function"==typeof(l=null!=(l=s(n,"messageReceivedImgPath")||(null!=t?s(t,"messageReceivedImgPath"):t))?l:e.hooks.helperMissing)?l.call(null!=t?t:e.nullContext||{},{name:"messageReceivedImgPath",hash:{},data:a,loc:{start:{line:45,column:24},end:{line:45,column:50}}}):l)+'\r\n                    alt="Знак получения сообщения"\r\n                    class="chatMessage__messageIsReceivedIcon"\r\n                >\r\n'},21:function(e,t,n,r,a){return'                    class="chatMessage__timeSign chatMessage__timeSign_messageContent_img"\r\n'},compiler:[8,">= 4.3.0"],main:function(e,t,n,r,a){var l,s,o=null!=t?t:e.nullContext||{},i=e.lookupProperty||function(e,t){if(Object.prototype.hasOwnProperty.call(e,t))return e[t]};return"<div>\r\n<div \r\n"+(null!=(l=i(n,"unless").call(o,null!=t?i(t,"isMessageSent"):t,{name:"unless",hash:{},fn:e.program(1,a,0),inverse:e.noop,data:a,loc:{start:{line:3,column:4},end:{line:5,column:15}}}))?l:"")+'    class="chatMessage">\r\n'+(null!=(l=i(n,"if").call(o,null!=t?i(t,"withDate"):t,{name:"if",hash:{},fn:e.program(3,a,0),inverse:e.noop,data:a,loc:{start:{line:7,column:4},end:{line:9,column:11}}}))?l:"")+"    <div \r\n"+(null!=(l=i(n,"if").call(o,null!=t?i(t,"imgPath"):t,{name:"if",hash:{},fn:e.program(5,a,0),inverse:e.noop,data:a,loc:{start:{line:11,column:8},end:{line:15,column:15}}}))?l:"")+(null!=(l=i(n,"if").call(o,null!=t?i(t,"imgPath"):t,{name:"if",hash:{},fn:e.program(8,a,0),inverse:e.noop,data:a,loc:{start:{line:16,column:8},end:{line:18,column:15}}}))?l:"")+(null!=(l=i(n,"if").call(o,null!=t?i(t,"isMessageSent"):t,{name:"if",hash:{},fn:e.program(10,a,0),inverse:e.noop,data:a,loc:{start:{line:19,column:8},end:{line:21,column:15}}}))?l:"")+'        class="chatMessage__content"\r\n    >\r\n'+(null!=(l=i(n,"if").call(o,null!=t?i(t,"textMessage"):t,{name:"if",hash:{},fn:e.program(12,a,0),inverse:e.noop,data:a,loc:{start:{line:24,column:8},end:{line:28,column:15}}}))?l:"")+(null!=(l=i(n,"if").call(o,null!=t?i(t,"imgPath"):t,{name:"if",hash:{},fn:e.program(14,a,0),inverse:e.noop,data:a,loc:{start:{line:29,column:8},end:{line:35,column:15}}}))?l:"")+"        <div\r\n"+(null!=(l=i(n,"if").call(o,null!=t?i(t,"imgPath"):t,{name:"if",hash:{},fn:e.program(16,a,0),inverse:e.noop,data:a,loc:{start:{line:37,column:12},end:{line:39,column:19}}}))?l:"")+'            class="chatMessage__time"\r\n        >\r\n'+(null!=(l=i(n,"if").call(o,null!=t?i(t,"isMessageSent"):t,{name:"if",hash:{},fn:e.program(18,a,0),inverse:e.noop,data:a,loc:{start:{line:42,column:12},end:{line:50,column:19}}}))?l:"")+"            <p\r\n"+(null!=(l=i(n,"if").call(o,null!=t?i(t,"imgPath"):t,{name:"if",hash:{},fn:e.program(21,a,0),inverse:e.noop,data:a,loc:{start:{line:52,column:16},end:{line:54,column:23}}}))?l:"")+'                class="chatMessage__timeSign"\r\n            >\r\n                '+e.escapeExpression("function"==typeof(s=null!=(s=i(n,"messageTime")||(null!=t?i(t,"messageTime"):t))?s:e.hooks.helperMissing)?s.call(o,{name:"messageTime",hash:{},data:a,loc:{start:{line:57,column:16},end:{line:57,column:31}}}):s)+"\r\n            </p>\r\n        </div>\r\n    </div>\r\n</div>\r\n</div>\r\n"},useData:!0});class ie extends W{constructor(e){super({...e,messageReceivedImgPath:t(se)})}render(){return this.compile(oe,this.props)}}var ue=t($).template({compiler:[8,">= 4.3.0"],main:function(e,t,n,r,a){var l,s,o=null!=t?t:e.nullContext||{},i=e.hooks.helperMissing,u="function",c=e.lookupProperty||function(e,t){if(Object.prototype.hasOwnProperty.call(e,t))return e[t]};return"<div class='newMessage'>\r\n  "+(null!=(l=typeof(s=null!=(s=c(n,"AttachmentBtn")||(null!=t?c(t,"AttachmentBtn"):t))?s:i)===u?s.call(o,{name:"AttachmentBtn",hash:{},data:a,loc:{start:{line:2,column:2},end:{line:2,column:21}}}):s)?l:"")+"\r\n  "+(null!=(l=typeof(s=null!=(s=c(n,"Form")||(null!=t?c(t,"Form"):t))?s:i)===u?s.call(o,{name:"Form",hash:{},data:a,loc:{start:{line:3,column:2},end:{line:3,column:12}}}):s)?l:"")+"\r\n</div>"},useData:!0});let ce;(ce||(ce={})).Message="message";const pe={[ce.Message]:e=>((e,t,n)=>{const r=e.trim();return t.test(r)?null:n})(e,/(.|\s)*\S(.|\s)*/,"Пустое поле недопустимо")};class he extends W{constructor(e){super(e)}init(){this.children.AttachmentBtn=new z({stylesType:q.Attachment,label:"",noValidation:!0});const e=new ne({isTextArea:!0,name:"message",inputStyle:"newMessage__textArea",placeholder:"Сообщение"}),t=new K({name:"message",label:"",input:e,errorStyle:"newMessage__errorText",labelStyle:"newMessage__inputLabel"});this.children.Form=new Q({fields:[t],inputs:[e],submit:({message:e})=>{this.props.sendMessage(e)},submitBtn:new z({label:"→",stylesType:q.Submit,styles:"newMessage__submitBtn",noValidation:!0}),formClass:"newMessage__form",validationRules:pe,shouldCleanOnSubmit:!0})}render(){return this.compile(ue,this.children)}}var de=t($).template({1:function(e,t,n,r,a){return"class='chatSettings__list chatSettings__list_open'"},3:function(e,t,n,r,a){var l;return"      <li class='chatSettings__item'>\r\n      "+(null!=(l=e.lambda(t,t))?l:"")+"\r\n    </li>\r\n"},compiler:[8,">= 4.3.0"],main:function(e,t,n,r,a){var l,s,o=null!=t?t:e.nullContext||{},i=e.lookupProperty||function(e,t){if(Object.prototype.hasOwnProperty.call(e,t))return e[t]};return"<div class='chatSettings'>\r\n  "+(null!=(l="function"==typeof(s=null!=(s=i(n,"openBtn")||(null!=t?i(t,"openBtn"):t))?s:e.hooks.helperMissing)?s.call(o,{name:"openBtn",hash:{},data:a,loc:{start:{line:2,column:2},end:{line:2,column:15}}}):s)?l:"")+"\r\n\r\n  <ul "+(null!=(l=i(n,"if").call(o,null!=t?i(t,"isOpen"):t,{name:"if",hash:{},fn:e.program(1,a,0),inverse:e.noop,data:a,loc:{start:{line:4,column:6},end:{line:4,column:77}}}))?l:"")+' class="chatSettings__list">\r\n'+(null!=(l=i(n,"each").call(o,null!=t?i(t,"buttons"):t,{name:"each",hash:{},fn:e.program(3,a,0),inverse:e.noop,data:a,loc:{start:{line:5,column:4},end:{line:9,column:13}}}))?l:"")+"  </ul>\r\n</div>\r\n"},useData:!0});class me extends W{constructor(e){super(e)}render(){return this.compile(de,this.props)}}var fe=t($).template({compiler:[8,">= 4.3.0"],main:function(e,t,n,r,a){return"<div class='chatSettings__middleSettingsDot'></div>"},useData:!0});class ge extends W{constructor(){super({})}render(){return this.compile(fe,this.props)}}const ye=({clickDeleteChat:e,clickAddUser:t,clickDeleteUser:n,clickEditAvatar:r})=>[new z({label:"Удалить чат",noValidation:!0,stylesType:q.Custom,styles:"chatSettings__actionBtn",events:{click:e}}),new z({label:"Добавить пользователя",noValidation:!0,stylesType:q.Custom,styles:"chatSettings__actionBtn",events:{click:t}}),new z({label:"Удалить пользователя",noValidation:!0,stylesType:q.Custom,styles:"chatSettings__actionBtn",events:{click:n}}),new z({label:"Изменить аватар",noValidation:!0,stylesType:q.Custom,styles:"chatSettings__actionBtn",events:{click:r}})],ve=({clickCreateChat:e})=>[new z({label:"Создать чат",noValidation:!0,stylesType:q.Custom,styles:"chatSettings__actionBtn",events:{click:e}})];var _e=t($).template({1:function(e,t,n,r,a){var l,s,o=null!=t?t:e.nullContext||{},i=e.hooks.helperMissing,u="function",c=e.lookupProperty||function(e,t){if(Object.prototype.hasOwnProperty.call(e,t))return e[t]};return'    <div class="chat__head">\r\n'+(null!=(l=c(n,"if").call(o,null!=t?c(t,"avatarSrc"):t,{name:"if",hash:{},fn:e.program(2,a,0),inverse:e.program(4,a,0),data:a,loc:{start:{line:4,column:8},end:{line:8,column:15}}}))?l:"")+'            <h2 class="chat__name">'+e.escapeExpression(typeof(s=null!=(s=c(n,"chatName")||(null!=t?c(t,"chatName"):t))?s:i)===u?s.call(o,{name:"chatName",hash:{},data:a,loc:{start:{line:9,column:35},end:{line:9,column:47}}}):s)+"</h2>\r\n        "+(null!=(l=typeof(s=null!=(s=c(n,"ChatSettings")||(null!=t?c(t,"ChatSettings"):t))?s:i)===u?s.call(o,{name:"ChatSettings",hash:{},data:a,loc:{start:{line:10,column:8},end:{line:10,column:26}}}):s)?l:"")+"\r\n    </div>\r\n"},2:function(e,t,n,r,a){var l,s=e.lookupProperty||function(e,t){if(Object.prototype.hasOwnProperty.call(e,t))return e[t]};return'            <img src="'+e.escapeExpression("function"==typeof(l=null!=(l=s(n,"avatarSrc")||(null!=t?s(t,"avatarSrc"):t))?l:e.hooks.helperMissing)?l.call(null!=t?t:e.nullContext||{},{name:"avatarSrc",hash:{},data:a,loc:{start:{line:5,column:22},end:{line:5,column:35}}}):l)+'" alt="avatar" class="chat__avatar">\r\n'},4:function(e,t,n,r,a){return'            <div class="chat__avatar chat__avatar_empty"></div>\r\n'},6:function(e,t,n,r,a){return'class="chat__messagesWindow"'},8:function(e,t,n,r,a){var l,s=e.lookupProperty||function(e,t){if(Object.prototype.hasOwnProperty.call(e,t))return e[t]};return null!=(l=s(n,"each").call(null!=t?t:e.nullContext||{},null!=t?s(t,"chatMessages"):t,{name:"each",hash:{},fn:e.program(9,a,0),inverse:e.noop,data:a,loc:{start:{line:15,column:12},end:{line:17,column:21}}}))?l:""},9:function(e,t,n,r,a){var l;return"                "+(null!=(l=e.lambda(t,t))?l:"")+"\r\n"},11:function(e,t,n,r,a){return'            <p class="chat__chooseChatSign">Выберите чат чтобы отправить сообщение</p>\r\n'},13:function(e,t,n,r,a){var l,s,o=e.lookupProperty||function(e,t){if(Object.prototype.hasOwnProperty.call(e,t))return e[t]};return null!=(l="function"==typeof(s=null!=(s=o(n,"ChatMessageInput")||(null!=t?o(t,"ChatMessageInput"):t))?s:e.hooks.helperMissing)?s.call(null!=t?t:e.nullContext||{},{name:"ChatMessageInput",hash:{},data:a,loc:{start:{line:22,column:26},end:{line:22,column:48}}}):s)?l:""},compiler:[8,">= 4.3.0"],main:function(e,t,n,r,a){var l,s,o=null!=t?t:e.nullContext||{},i=e.lookupProperty||function(e,t){if(Object.prototype.hasOwnProperty.call(e,t))return e[t]};return'<div class="chat">\r\n'+(null!=(l=i(n,"if").call(o,null!=t?i(t,"isChatSelected"):t,{name:"if",hash:{},fn:e.program(1,a,0),inverse:e.noop,data:a,loc:{start:{line:2,column:4},end:{line:12,column:11}}}))?l:"")+"    <div "+(null!=(l=i(n,"if").call(o,null!=t?i(t,"isChatSelected"):t,{name:"if",hash:{},fn:e.program(6,a,0),inverse:e.noop,data:a,loc:{start:{line:13,column:9},end:{line:13,column:66}}}))?l:"")+' class="chat__messagesWindow chat__messagesWindow_chatIsNotSelected">\r\n'+(null!=(l=i(n,"if").call(o,null!=t?i(t,"isChatSelected"):t,{name:"if",hash:{},fn:e.program(8,a,0),inverse:e.program(11,a,0),data:a,loc:{start:{line:14,column:8},end:{line:20,column:15}}}))?l:"")+"    </div>\r\n    "+(null!=(l=i(n,"if").call(o,null!=t?i(t,"isChatSelected"):t,{name:"if",hash:{},fn:e.program(13,a,0),inverse:e.noop,data:a,loc:{start:{line:22,column:4},end:{line:22,column:55}}}))?l:"")+"\r\n    "+(null!=(l="function"==typeof(s=null!=(s=i(n,"Modal")||(null!=t?i(t,"Modal"):t))?s:e.hooks.helperMissing)?s.call(o,{name:"Modal",hash:{},data:a,loc:{start:{line:23,column:4},end:{line:23,column:15}}}):s)?l:"")+"\r\n</div>\r\n"},useData:!0});const we=T(class extends W{constructor(e){super({...e,Modal:null,areSettingsOpen:!1})}init(){this.children.ChatSettings=new me({isOpen:!1,buttons:ve({clickCreateChat:()=>this.props.Modal="create-chat"}),openBtn:new z({label:"",noValidation:!0,stylesType:q.Custom,styles:"chatSettings__settingsBtn",child:new ge,events:{click:()=>this.props.areSettingsOpen=!this.props.areSettingsOpen}})}),this.children.ChatMessageInput=new he({sendMessage:e=>{this.props.chatId&&this.props.messagesController.sendMessage(this.props.chatId,e)}})}closeModal(){this.props.Modal=null}componentDidUpdate(e,t){if(e.Modal!==t.Modal&&(this.props.areSettingsOpen=!1,this.props.chatId)){const e=le(this.closeModal.bind(this),this.props.chatId,this.props.chatsController,t.Modal);e&&e.dispatchComponentDidMount(),this.children.Modal=e}if(e.areSettingsOpen!==t.areSettingsOpen){this.children.ChatSettings.props.isOpen=!!t.areSettingsOpen}return e.isChatSelected!==t.isChatSelected&&(t.isChatSelected?(this.children.ChatSettings=new me({isOpen:!1,buttons:ye({clickDeleteChat:()=>this.props.Modal="delete-chat",clickAddUser:()=>this.props.Modal="add-user",clickDeleteUser:()=>this.props.Modal="delete-user",clickEditAvatar:()=>this.props.Modal="change-avatar"}),openBtn:new z({label:"",noValidation:!0,stylesType:q.Custom,styles:"chatSettings__settingsBtn",child:new ge,events:{click:()=>this.props.areSettingsOpen=!this.props.areSettingsOpen}})}),this.renderMessages()):this.children.ChatSettings=new me({isOpen:!1,buttons:ve({clickCreateChat:()=>this.props.Modal="create-chat"}),openBtn:new z({label:"",noValidation:!0,stylesType:q.Custom,styles:"chatSettings__settingsBtn",child:new ge,events:{click:()=>this.props.areSettingsOpen=!this.props.areSettingsOpen}})})),R(e.chatMessages,t.chatMessages)||this.renderMessages(),!R(e,t)}renderMessages(){this.children.chatMessages=this.props.chatMessages?.map((e=>{const t=new Date(e.time),n=`${t.getHours()}:${t.getMinutes()}`;return new ie({isMessageSent:e.user_id===this.props.userId,messageTime:n,textMessage:e.content})}))}render(){return this.compile(_e,this.props)}},{chatsController:new D,messagesController:new L});var be=U((e=>{const t=e.selectedChat?.id;return{isChatSelected:void 0!==e.selectedChat,chatId:t,chatMessages:void 0!==t&&e.messages&&t in e.messages?[...e.messages[t]]:[],userId:e.user?.id,chatName:e.selectedChat?.chatName,avatarSrc:e.selectedChat?.avatarSrc}}))(we);var Pe=t($).template({compiler:[8,">= 4.3.0"],main:function(e,t,n,r,a){var l,s=null!=t?t:e.nullContext||{},o=e.hooks.helperMissing,i="function",u=e.escapeExpression,c=e.lookupProperty||function(e,t){if(Object.prototype.hasOwnProperty.call(e,t))return e[t]};return'<a href="'+u(typeof(l=null!=(l=c(n,"href")||(null!=t?c(t,"href"):t))?l:o)===i?l.call(s,{name:"href",hash:{},data:a,loc:{start:{line:1,column:9},end:{line:1,column:17}}}):l)+'" class="anchorLink '+u(typeof(l=null!=(l=c(n,"styles")||(null!=t?c(t,"styles"):t))?l:o)===i?l.call(s,{name:"styles",hash:{},data:a,loc:{start:{line:1,column:37},end:{line:1,column:47}}}):l)+'">'+u(typeof(l=null!=(l=c(n,"text")||(null!=t?c(t,"text"):t))?l:o)===i?l.call(s,{name:"text",hash:{},data:a,loc:{start:{line:1,column:49},end:{line:1,column:57}}}):l)+"</a>\r\n"},useData:!0});class ke extends W{constructor(e){super(e)}render(){return this.compile(Pe,this.props)}}var Se=t($).template({1:function(e,t,n,r,a){return'class="message message_unread"'},3:function(e,t,n,r,a){var l,s=e.lookupProperty||function(e,t){if(Object.prototype.hasOwnProperty.call(e,t))return e[t]};return'            <img src="'+e.escapeExpression("function"==typeof(l=null!=(l=s(n,"imgSrc")||(null!=t?s(t,"imgSrc"):t))?l:e.hooks.helperMissing)?l.call(null!=t?t:e.nullContext||{},{name:"imgSrc",hash:{},data:a,loc:{start:{line:4,column:22},end:{line:4,column:32}}}):l)+'" alt="avatar" class="message__avatar">\r\n'},5:function(e,t,n,r,a){return'            <div class="message__avatar message__avatar_empty"></div>\r\n'},7:function(e,t,n,r,a){var l,s=e.lookupProperty||function(e,t){if(Object.prototype.hasOwnProperty.call(e,t))return e[t]};return'            <p class="message__text">'+e.escapeExpression("function"==typeof(l=null!=(l=s(n,"message")||(null!=t?s(t,"message"):t))?l:e.hooks.helperMissing)?l.call(null!=t?t:e.nullContext||{},{name:"message",hash:{},data:a,loc:{start:{line:11,column:37},end:{line:11,column:48}}}):l)+"</p>\r\n"},9:function(e,t,n,r,a){var l,s=e.lookupProperty||function(e,t){if(Object.prototype.hasOwnProperty.call(e,t))return e[t]};return'            <p class="message__text">\r\n                <span class="message__text_highlighted">Вы:&nbsp;</span>\r\n                '+e.escapeExpression("function"==typeof(l=null!=(l=s(n,"message")||(null!=t?s(t,"message"):t))?l:e.hooks.helperMissing)?l.call(null!=t?t:e.nullContext||{},{name:"message",hash:{},data:a,loc:{start:{line:15,column:16},end:{line:15,column:27}}}):l)+"\r\n            </p>\r\n"},11:function(e,t,n,r,a){var l,s=e.lookupProperty||function(e,t){if(Object.prototype.hasOwnProperty.call(e,t))return e[t]};return'            <p class="message__unreadCount">'+e.escapeExpression("function"==typeof(l=null!=(l=s(n,"unreadMessagesCount")||(null!=t?s(t,"unreadMessagesCount"):t))?l:e.hooks.helperMissing)?l.call(null!=t?t:e.nullContext||{},{name:"unreadMessagesCount",hash:{},data:a,loc:{start:{line:19,column:44},end:{line:19,column:67}}}):l)+"</p>\r\n"},compiler:[8,">= 4.3.0"],main:function(e,t,n,r,a){var l,s,o=null!=t?t:e.nullContext||{},i=e.hooks.helperMissing,u="function",c=e.escapeExpression,p=e.lookupProperty||function(e,t){if(Object.prototype.hasOwnProperty.call(e,t))return e[t]};return"<div>\r\n    <li "+(null!=(l=p(n,"if").call(o,null!=t?p(t,"isMessageSelected"):t,{name:"if",hash:{},fn:e.program(1,a,0),inverse:e.noop,data:a,loc:{start:{line:2,column:8},end:{line:2,column:70}}}))?l:"")+' class="message">\r\n'+(null!=(l=p(n,"if").call(o,null!=t?p(t,"imgSrc"):t,{name:"if",hash:{},fn:e.program(3,a,0),inverse:e.program(5,a,0),data:a,loc:{start:{line:3,column:8},end:{line:7,column:15}}}))?l:"")+'        <p class="message__chatName">'+c(typeof(s=null!=(s=p(n,"chatName")||(null!=t?p(t,"chatName"):t))?s:i)===u?s.call(o,{name:"chatName",hash:{},data:a,loc:{start:{line:8,column:37},end:{line:8,column:49}}}):s)+'</p>\r\n        <p class="message__date">'+c(typeof(s=null!=(s=p(n,"messageDate")||(null!=t?p(t,"messageDate"):t))?s:i)===u?s.call(o,{name:"messageDate",hash:{},data:a,loc:{start:{line:9,column:33},end:{line:9,column:48}}}):s)+"</p>\r\n"+(null!=(l=p(n,"if").call(o,null!=t?p(t,"isMessageReceived"):t,{name:"if",hash:{},fn:e.program(7,a,0),inverse:e.program(9,a,0),data:a,loc:{start:{line:10,column:8},end:{line:17,column:15}}}))?l:"")+(null!=(l=p(n,"if").call(o,null!=t?p(t,"unreadMessagesCount"):t,{name:"if",hash:{},fn:e.program(11,a,0),inverse:e.noop,data:a,loc:{start:{line:18,column:8},end:{line:20,column:15}}}))?l:"")+"    </li>\r\n</div>\r\n"},useData:!0});class Ce extends W{constructor(e){super({...e,isMessageSelected:e.chatId===e.selectedChatId})}componentDidUpdate(e,t){return e.selectedChatId!==t.selectedChatId&&(this.props.isMessageSelected=this.props.chatId===t.selectedChatId),t.selectedChatAvatar&&e.selectedChatAvatar!==t.selectedChatAvatar&&this.props.isMessageSelected&&(this.props.imgSrc=t.selectedChatAvatar),!R(e,t)}render(){return this.compile(Se,this.props)}}const Me=e=>({selectedChatId:e.selectedChat?.id,selectedChatAvatar:e.selectedChat?.avatarSrc});var xe=t($).template({1:function(e,t,n,r,a){var l;return"      "+(null!=(l=e.lambda(t,t))?l:"")+"\r\n"},compiler:[8,">= 4.3.0"],main:function(e,t,n,r,a){var l,s,o=null!=t?t:e.nullContext||{},i=e.lookupProperty||function(e,t){if(Object.prototype.hasOwnProperty.call(e,t))return e[t]};return"<div class='messages'>\r\n  <div class='messages__head'>\r\n    "+(null!=(l="function"==typeof(s=null!=(s=i(n,"ProfileLink")||(null!=t?i(t,"ProfileLink"):t))?s:e.hooks.helperMissing)?s.call(o,{name:"ProfileLink",hash:{},data:a,loc:{start:{line:3,column:4},end:{line:3,column:21}}}):s)?l:"")+"\r\n    <input type='text' class='messages__searchInput' placeholder='Поиск' />\r\n  </div>\r\n  <ul class='messages__list'>\r\n"+(null!=(l=i(n,"each").call(o,null!=t?i(t,"foundMessages"):t,{name:"each",hash:{},fn:e.program(1,a,0),inverse:e.noop,data:a,loc:{start:{line:7,column:4},end:{line:9,column:13}}}))?l:"")+(null!=(l=i(n,"each").call(o,null!=t?i(t,"chats"):t,{name:"each",hash:{},fn:e.program(1,a,0),inverse:e.noop,data:a,loc:{start:{line:10,column:4},end:{line:12,column:13}}}))?l:"")+"  </ul>\r\n</div>\r\n"},useData:!0});const Oe=T(class extends W{constructor(e){super(e)}async init(){this.children.ProfileLink=new ke({href:"/",text:"Профиль >",events:{click:e=>{e.preventDefault(),this.props.router.go(f.Profile)}},styles:"messages__profileLink"})}async componentDidMount(){await this.props.chatsController.getChats({limit:50,offset:0}),this.props.chats?.forEach((async e=>{await this.props.messagesController.connect(e.id,e.token)}))}componentDidUpdate(e,t){return R(e.lastChatMessages,t.lastChatMessages)?!R(e,t):(this.children.chats=this.createChats(),!0)}render(){return this.compile(xe,{...this.props,...this.children})}createChats(){const e=this.props.chatsController,t=this.props.messagesController,n=this.props,r=this.props.lastChatMessages?.map((r=>new(U(Me)(Ce))({...r,events:{async click(){!!n.messages&&!!n.messages[r.chatId]&&n.messages[r.chatId].length>0||await t.fetchOldMessages(r.chatId,0),e.selectChat(r.chatId)}}})));return r}},{chatsController:new D,messagesController:new L,router:new _("#app")});var Ee=U((e=>({lastChatMessages:e.chats?.map((e=>({chatName:e.title,message:e.last_message?.content,messageDate:e.last_message?.time&&new Date(e.last_message?.time).toString(),imgSrc:e.avatar,unreadMessagesCount:e.unread_count,isMessageReceived:0===e.unread_count,isMessageSelected:!1,chatId:e.id}))),chats:e.chats?.map((e=>({id:e.id,token:e.token}))),messages:e.messages})))(Oe);var Le=t($).template({compiler:[8,">= 4.3.0"],main:function(e,t,n,r,a){var l,s,o=null!=t?t:e.nullContext||{},i=e.hooks.helperMissing,u="function",c=e.lookupProperty||function(e,t){if(Object.prototype.hasOwnProperty.call(e,t))return e[t]};return"<div>\r\n  <main class='mainGrid'>\r\n    "+(null!=(l=typeof(s=null!=(s=c(n,"MessagesList")||(null!=t?c(t,"MessagesList"):t))?s:i)===u?s.call(o,{name:"MessagesList",hash:{},data:a,loc:{start:{line:3,column:4},end:{line:3,column:22}}}):s)?l:"")+"\r\n    "+(null!=(l=typeof(s=null!=(s=c(n,"Chat")||(null!=t?c(t,"Chat"):t))?s:i)===u?s.call(o,{name:"Chat",hash:{},data:a,loc:{start:{line:4,column:4},end:{line:4,column:14}}}):s)?l:"")+"\r\n    "+(null!=(l=typeof(s=null!=(s=c(n,"Modal")||(null!=t?c(t,"Modal"):t))?s:i)===u?s.call(o,{name:"Modal",hash:{},data:a,loc:{start:{line:5,column:4},end:{line:5,column:15}}}):s)?l:"")+"\r\n  </main>\r\n</div>"},useData:!0});class Ae extends W{constructor(e){super(e)}async init(){this.children.Chat=new be({}),this.children.MessagesList=new Ee({})}render(){return this.compile(Le,this.children)}}var Ie=t($).template({1:function(e,t,n,r,a){var l,s=e.lookupProperty||function(e,t){if(Object.prototype.hasOwnProperty.call(e,t))return e[t]};return"    <img src="+e.escapeExpression("function"==typeof(l=null!=(l=s(n,"avatarSrc")||(null!=t?s(t,"avatarSrc"):t))?l:e.hooks.helperMissing)?l.call(null!=t?t:e.nullContext||{},{name:"avatarSrc",hash:{},data:a,loc:{start:{line:4,column:13},end:{line:4,column:26}}}):l)+" alt='Аватар' class='profile__avatar' />\r\n"},3:function(e,t,n,r,a){return"    <div class='profile__avatar profile__avatar_type_tooltip'></div>\r\n"},compiler:[8,">= 4.3.0"],main:function(e,t,n,r,a){var l,s,o=null!=t?t:e.nullContext||{},i=e.lookupProperty||function(e,t){if(Object.prototype.hasOwnProperty.call(e,t))return e[t]};return"<div class='profile__inputWrapper'>\r\n  "+(null!=(l="function"==typeof(s=null!=(s=i(n,"openModalBtn")||(null!=t?i(t,"openModalBtn"):t))?s:e.hooks.helperMissing)?s.call(o,{name:"openModalBtn",hash:{},data:a,loc:{start:{line:2,column:2},end:{line:2,column:20}}}):s)?l:"")+"\r\n"+(null!=(l=i(n,"if").call(o,null!=t?i(t,"avatarSrc"):t,{name:"if",hash:{},fn:e.program(1,a,0),inverse:e.program(3,a,0),data:a,loc:{start:{line:3,column:2},end:{line:7,column:9}}}))?l:"")+"</div>"},useData:!0});class De extends W{constructor(e){super(e)}render(){return this.compile(Ie,this.props)}}var Te=t($).template({compiler:[8,">= 4.3.0"],main:function(e,t,n,r,a){return'<button class="profileGoBackBtn"></button>\r\n'},useData:!0});class Fe extends W{constructor(e){super(e)}render(){return this.compile(Te,this.props)}}class Be{constructor(){this.usersApi=new I}async editProfile(e){const t=await this.usersApi.update(e);C.set("user",t)}editPassword(e,t){return this.usersApi.editPassword(e,t)}async editAvatar(e){const t=await this.usersApi.editAvatar(e);t.avatar=s.ResourcesUrl+t.avatar,C.set("user",t)}}var je=t($).template({compiler:[8,">= 4.3.0"],main:function(e,t,n,r,a){var l,s,o=null!=t?t:e.nullContext||{},i=e.hooks.helperMissing,u="function",c=e.lookupProperty||function(e,t){if(Object.prototype.hasOwnProperty.call(e,t))return e[t]};return"<main class='profile'>\r\n  "+(null!=(l=typeof(s=null!=(s=c(n,"GoBackBtn")||(null!=t?c(t,"GoBackBtn"):t))?s:i)===u?s.call(o,{name:"GoBackBtn",hash:{},data:a,loc:{start:{line:2,column:2},end:{line:2,column:17}}}):s)?l:"")+"\r\n  <div class='profile__content'>\r\n    "+(null!=(l=typeof(s=null!=(s=c(n,"AvatarInput")||(null!=t?c(t,"AvatarInput"):t))?s:i)===u?s.call(o,{name:"AvatarInput",hash:{},data:a,loc:{start:{line:4,column:4},end:{line:4,column:21}}}):s)?l:"")+"\r\n    "+(null!=(l=typeof(s=null!=(s=c(n,"form")||(null!=t?c(t,"form"):t))?s:i)===u?s.call(o,{name:"form",hash:{},data:a,loc:{start:{line:5,column:4},end:{line:5,column:14}}}):s)?l:"")+"\r\n  </div>\r\n</main>"},useData:!0});let Ne;var Re;(Re=Ne||(Ne={})).OldPassword="oldPassword",Re.NewPassword="newPassword",Re.NewPasswordAgain="newPasswordAgain",Re.Login="login";const Ue=(e,t,n)=>{const r=e.trim();return t.test(r)?null:n},Ve={[Ne.OldPassword]:e=>Ue(e,/^(?=.*[a-z])(?=.*[A-Z])(?=.*\d)(?=.*[^\da-zA-Z]).{8,40}$/,"от 8 до 40 символов, обязательно хотя бы одна заглавная буква и цифра"),[Ne.NewPassword]:e=>Ue(e,/^(?=.*[a-z])(?=.*[A-Z])(?=.*\d)(?=.*[^\da-zA-Z]).{8,40}$/,"от 8 до 40 символов, обязательно хотя бы одна заглавная буква и цифра"),[Ne.NewPasswordAgain]:e=>Ue(e,/^(?=.*[a-z])(?=.*[A-Z])(?=.*\d)(?=.*[^\da-zA-Z]).{8,40}$/,"от 8 до 40 символов, обязательно хотя бы одна заглавная буква и цифра"),[Ne.Login]:e=>Ue(e,/^[a-zA-Z][a-zA-Z0-9\-_]{3,20}$/,"от 3 до 20 символов, латиница, может содержать цифры, но не состоять из них, без пробелов, без спецсимволов (допустимы дефис и нижнее подчёркивание)")};var He=T(U((e=>({avatarSrc:e.user?.avatar})))(class extends W{constructor(e){super(e)}init(){this.children.GoBackBtn=new Fe({events:{click:()=>w.back()}}),this.children.AvatarInput=new De({avatarSrc:this.props.avatarSrc});const e=new ne({inputStyle:"editProfileForm__input",type:"password",name:Ne.OldPassword}),t=new ne({inputStyle:"editProfileForm__input",type:"password",name:Ne.NewPassword}),n=new ne({inputStyle:"editProfileForm__input",type:"password",name:Ne.NewPasswordAgain}),r=[e,t,n],a=[new K({name:Ne.OldPassword,label:"Старый пароль",input:e,inputWrapperStyle:"editProfileForm__inputWrapper",labelStyle:"editProfileForm__inputLabel",errorStyle:"editProfileForm__inputError"}),new K({name:Ne.NewPassword,label:"Новый пароль",input:t,inputWrapperStyle:"editProfileForm__inputWrapper",labelStyle:"editProfileForm__inputLabel",errorStyle:"editProfileForm__inputError"}),new K({name:Ne.NewPasswordAgain,label:"Повторите пароль",input:n,inputWrapperStyle:"editProfileForm__inputWrapper",labelStyle:"editProfileForm__inputLabel",errorStyle:"editProfileForm__inputError"})],l=new z({label:"Сохранить",stylesType:q.Submit,styles:"authForm__signUpBtn"}),s=this.props;this.children.form=new Q({fields:a,submitBtn:l,submit:async function({newPassword:e,oldPassword:t}){try{await s.profileController.editPassword(t,e),s.authController.logout(f.SignInPage)}catch(e){const t=e.reason;l.props.actionError=t}},inputs:r,validationRules:Ve,formClass:"editProfileForm"})}render(){return this.compile(je,this.children)}}),{profileController:new Be,authController:new A});var We=t($).template({compiler:[8,">= 4.3.0"],main:function(e,t,n,r,a){var l,s,o=null!=t?t:e.nullContext||{},i=e.hooks.helperMissing,u="function",c=e.lookupProperty||function(e,t){if(Object.prototype.hasOwnProperty.call(e,t))return e[t]};return"<main class='profile'>\r\n  "+(null!=(l=typeof(s=null!=(s=c(n,"GoBackBtn")||(null!=t?c(t,"GoBackBtn"):t))?s:i)===u?s.call(o,{name:"GoBackBtn",hash:{},data:a,loc:{start:{line:2,column:2},end:{line:2,column:17}}}):s)?l:"")+"\r\n  <div class='profile__content'>\r\n    "+(null!=(l=typeof(s=null!=(s=c(n,"AvatarInput")||(null!=t?c(t,"AvatarInput"):t))?s:i)===u?s.call(o,{name:"AvatarInput",hash:{},data:a,loc:{start:{line:4,column:4},end:{line:4,column:21}}}):s)?l:"")+"\r\n    "+(null!=(l=typeof(s=null!=(s=c(n,"Form")||(null!=t?c(t,"Form"):t))?s:i)===u?s.call(o,{name:"Form",hash:{},data:a,loc:{start:{line:5,column:4},end:{line:5,column:14}}}):s)?l:"")+"\r\n  </div>\r\n  "+(null!=(l=typeof(s=null!=(s=c(n,"AvatarModal")||(null!=t?c(t,"AvatarModal"):t))?s:i)===u?s.call(o,{name:"AvatarModal",hash:{},data:a,loc:{start:{line:7,column:2},end:{line:7,column:19}}}):s)?l:"")+"\r\n</main>"},useData:!0});let $e;!function(e){e.Name="first_name",e.Surname="second_name",e.Login="login",e.Email="email",e.Phone="phone"}($e||($e={}));const Ge=(e,t,n)=>{const r=e.trim();return t.test(r)?null:n},qe={[$e.Name]:e=>Ge(e,/^[A-ZА-Я][\p{L}]*$/u,"Латиница или кириллица, первая буква должна быть заглавной, без пробелов и без цифр, нет спецсимволов"),[$e.Surname]:e=>Ge(e,/^[A-ZА-Я][\p{L}]*$/u,"Латиница или кириллица, первая буква должна быть заглавной, без пробелов и без цифр, нет спецсимволов"),[$e.Login]:e=>Ge(e,/^[a-zA-Z][a-zA-Z0-9\-_]{3,20}$/,"от 3 до 20 символов, латиница, может содержать цифры, но не состоять из них, без пробелов, без спецсимволов (допустимы дефис и нижнее подчёркивание)"),[$e.Email]:e=>Ge(e,/^[\w-.]+@([\w-]+\.)+[\w-]{2,4}$/,"латиница, может включать цифры и спецсимволы вроде дефиса, обязательно должна быть «собака» (@) и точка после неё, но перед точкой обязательно должны быть буквы"),[$e.Phone]:e=>Ge(e,/^\+?[0-9]{10,15}$/,"От 10 до 15 символов, состоит из цифр, может начинается с плюса")};var Ze=T(U((e=>({user:e.user})))(class extends W{constructor(e){super(e)}init(){this.children.GoBackBtn=new Fe({events:{click:()=>w.back()}}),this.renderForm()}componentDidUpdate(e,t){return R(e.user,t.user)?!R(e,t):(this.renderForm(),!0)}closeModal(){this.children.AvatarModal=void 0,this.props.isModalOpen=!1}async submitAvatar(e){const t=new FormData;t.append("avatar",e),await this.props.profileController.editAvatar(t)}renderModal(){const e=new te({type:"file",name:"avatar",id:"avatar",inputStyle:"modal__fileInput"}),t=new K({input:e,label:"Выберите файл",name:"avatar",labelStyle:"modal__fileInputLabel"}),n=new Y({fields:[t],inputs:[e],submit:async({avatar:e})=>{e&&await this.submitAvatar(e)},submitBtn:new z({label:"Поменять аватар",stylesType:q.Submit,type:"submit"}),formClass:"modal__fileForm"}),r=new ae({content:[n],header:"Изменить аватар",isOpen:!0,onClose:this.closeModal.bind(this)});this.children.AvatarModal=r,this.props.isModalOpen=!0,r.dispatchComponentDidMount()}renderForm(){const e=this.renderModal.bind(this),t=new z({label:"",noValidation:!0,styles:"editProfileForm__openAvatarModal profile__changeAvatarBtn",events:{click:e}});this.children.AvatarInput=new De({openModalBtn:t,avatarSrc:this.props.user?.avatar});const n=new ne({inputStyle:"editProfileForm__input",type:"text",name:"first_name",value:this.props.user?.first_name??""}),r=new ne({inputStyle:"editProfileForm__input",type:"text",name:"second_name",value:this.props.user?.second_name??""}),a=new ne({inputStyle:"editProfileForm__input",type:"text",name:"login",value:this.props.user?.login??""}),l=new ne({inputStyle:"editProfileForm__input",type:"email",name:"email",value:this.props.user?.email??""}),s=new ne({inputStyle:"editProfileForm__input",type:"tel",name:"phone",value:this.props.user?.phone.toString()??""}),o=[n,r,a,l,s],i=[new K({name:"first_name",label:"Имя",input:n,inputWrapperStyle:"editProfileForm__inputWrapper",labelStyle:"editProfileForm__inputLabel",errorStyle:"editProfileForm__inputError"}),new K({name:"second_name",label:"Фамилия",input:r,inputWrapperStyle:"editProfileForm__inputWrapper",labelStyle:"editProfileForm__inputLabel",errorStyle:"editProfileForm__inputError"}),new K({name:"login",label:"Логин *",input:a,inputWrapperStyle:"editProfileForm__inputWrapper",labelStyle:"editProfileForm__inputLabel",errorStyle:"editProfileForm__inputError"}),new K({name:"email",label:"Email *",input:l,inputWrapperStyle:"editProfileForm__inputWrapper",labelStyle:"editProfileForm__inputLabel",errorStyle:"editProfileForm__inputError"}),new K({name:"phone",label:"Телефон *",input:s,inputWrapperStyle:"editProfileForm__inputWrapper",labelStyle:"editProfileForm__inputLabel",errorStyle:"editProfileForm__inputError"})],u=this.props.profileController,c=this.props.user??{};this.children.Form=new Q({fields:i,submitBtn:new z({label:"Сохранить",stylesType:q.Submit,styles:"authForm__signUpBtn"}),async submit(e){await u.editProfile({...c,...e,display_name:c.display_name??""})},inputs:o,validationRules:qe,formClass:"editProfileForm"}),this.children.Form.componentDidMount()}render(){return this.compile(We,this.children)}}),{profileController:new Be});var ze=t($).template({compiler:[8,">= 4.3.0"],main:function(e,t,n,r,a){var l,s,o=null!=t?t:e.nullContext||{},i=e.hooks.helperMissing,u="function",c=e.escapeExpression,p=e.lookupProperty||function(e,t){if(Object.prototype.hasOwnProperty.call(e,t))return e[t]};return"<main class='errorPage'>\r\n  <h2 class='errorPage__error'>"+c(typeof(s=null!=(s=p(n,"statusCode")||(null!=t?p(t,"statusCode"):t))?s:i)===u?s.call(o,{name:"statusCode",hash:{},data:a,loc:{start:{line:2,column:31},end:{line:2,column:45}}}):s)+"</h2>\r\n  <p class='errorPage__text'>"+c(typeof(s=null!=(s=p(n,"text")||(null!=t?p(t,"text"):t))?s:i)===u?s.call(o,{name:"text",hash:{},data:a,loc:{start:{line:3,column:29},end:{line:3,column:37}}}):s)+"</p>\r\n  "+(null!=(l=typeof(s=null!=(s=p(n,"Link")||(null!=t?p(t,"Link"):t))?s:i)===u?s.call(o,{name:"Link",hash:{},data:a,loc:{start:{line:4,column:2},end:{line:4,column:12}}}):s)?l:"")+"\r\n</main>"},useData:!0});class Je extends W{constructor(e){super(e)}init(){this.children.Link=new ke({href:"/",text:"Назад к чатам",events:{click(e){e.preventDefault(),w.go(f.Chat)}}})}render(){return this.compile(ze,{Link:this.children.Link,...this.props})}}var Ke=t($).template({1:function(e,t,n,r,a){var l,s=e.lookupProperty||function(e,t){if(Object.prototype.hasOwnProperty.call(e,t))return e[t]};return"      <img src="+e.escapeExpression("function"==typeof(l=null!=(l=s(n,"avatarSrc")||(null!=t?s(t,"avatarSrc"):t))?l:e.hooks.helperMissing)?l.call(null!=t?t:e.nullContext||{},{name:"avatarSrc",hash:{},data:a,loc:{start:{line:5,column:15},end:{line:5,column:28}}}):l)+" alt='Аватар' class='profile__avatar' />\r\n"},3:function(e,t,n,r,a){return"      <div class='profile__avatar profile__avatar_type_tooltip'></div>\r\n"},compiler:[8,">= 4.3.0"],main:function(e,t,n,r,a){var l,s,o=null!=t?t:e.nullContext||{},i=e.hooks.helperMissing,u="function",c=e.escapeExpression,p=e.lookupProperty||function(e,t){if(Object.prototype.hasOwnProperty.call(e,t))return e[t]};return"<main class='profile'>\r\n  "+(null!=(l=typeof(s=null!=(s=p(n,"GoBackBtn")||(null!=t?p(t,"GoBackBtn"):t))?s:i)===u?s.call(o,{name:"GoBackBtn",hash:{},data:a,loc:{start:{line:2,column:2},end:{line:2,column:17}}}):s)?l:"")+"\r\n  <div class='profile__content'>\r\n"+(null!=(l=p(n,"if").call(o,null!=t?p(t,"avatarSrc"):t,{name:"if",hash:{},fn:e.program(1,a,0),inverse:e.program(3,a,0),data:a,loc:{start:{line:4,column:4},end:{line:8,column:11}}}))?l:"")+"    <h2 class='profile__name'>"+c(typeof(s=null!=(s=p(n,"profileName")||(null!=t?p(t,"profileName"):t))?s:i)===u?s.call(o,{name:"profileName",hash:{},data:a,loc:{start:{line:9,column:30},end:{line:9,column:45}}}):s)+"</h2>\r\n    <div class='profile__lists'>\r\n      <ul class='profile__infoList'>\r\n        <li class='profile__infoListItem'>\r\n          <p class='profile__infoListItemName'>Почта</p>\r\n          <p class='profile__infoListItemValue'>"+c(typeof(s=null!=(s=p(n,"email")||(null!=t?p(t,"email"):t))?s:i)===u?s.call(o,{name:"email",hash:{},data:a,loc:{start:{line:14,column:48},end:{line:14,column:57}}}):s)+"</p>\r\n        </li>\r\n        <li class='profile__infoListItem'>\r\n          <p class='profile__infoListItemName'>Логин</p>\r\n          <p class='profile__infoListItemValue'>"+c(typeof(s=null!=(s=p(n,"login")||(null!=t?p(t,"login"):t))?s:i)===u?s.call(o,{name:"login",hash:{},data:a,loc:{start:{line:18,column:48},end:{line:18,column:57}}}):s)+"</p>\r\n        </li>\r\n        <li class='profile__infoListItem'>\r\n          <p class='profile__infoListItemName'>Имя</p>\r\n          <p class='profile__infoListItemValue'>"+c(typeof(s=null!=(s=p(n,"name")||(null!=t?p(t,"name"):t))?s:i)===u?s.call(o,{name:"name",hash:{},data:a,loc:{start:{line:22,column:48},end:{line:22,column:56}}}):s)+"</p>\r\n        </li>\r\n        <li class='profile__infoListItem'>\r\n          <p class='profile__infoListItemName'>Фамилия</p>\r\n          <p class='profile__infoListItemValue'>"+c(typeof(s=null!=(s=p(n,"surname")||(null!=t?p(t,"surname"):t))?s:i)===u?s.call(o,{name:"surname",hash:{},data:a,loc:{start:{line:26,column:48},end:{line:26,column:59}}}):s)+"</p>\r\n        </li>\r\n        <li class='profile__infoListItem'>\r\n          <p class='profile__infoListItemName'>Имя в чате</p>\r\n          <p class='profile__infoListItemValue'>"+c(typeof(s=null!=(s=p(n,"chatName")||(null!=t?p(t,"chatName"):t))?s:i)===u?s.call(o,{name:"chatName",hash:{},data:a,loc:{start:{line:30,column:48},end:{line:30,column:60}}}):s)+"</p>\r\n        </li>\r\n        <li class='profile__infoListItem'>\r\n          <p class='profile__infoListItemName'>Телефон</p>\r\n          <p class='profile__infoListItemValue'>"+c(typeof(s=null!=(s=p(n,"telephone")||(null!=t?p(t,"telephone"):t))?s:i)===u?s.call(o,{name:"telephone",hash:{},data:a,loc:{start:{line:34,column:48},end:{line:34,column:61}}}):s)+"</p>\r\n        </li>\r\n      </ul>\r\n      <ul class='profile__links'>\r\n        <li class='profile__linksItem'>\r\n          "+(null!=(l=typeof(s=null!=(s=p(n,"ChangeDataLink")||(null!=t?p(t,"ChangeDataLink"):t))?s:i)===u?s.call(o,{name:"ChangeDataLink",hash:{},data:a,loc:{start:{line:39,column:10},end:{line:39,column:30}}}):s)?l:"")+"\r\n        </li>\r\n        <li class='profile__linksItem'>\r\n          "+(null!=(l=typeof(s=null!=(s=p(n,"ChangePasswordLink")||(null!=t?p(t,"ChangePasswordLink"):t))?s:i)===u?s.call(o,{name:"ChangePasswordLink",hash:{},data:a,loc:{start:{line:42,column:10},end:{line:42,column:34}}}):s)?l:"")+"\r\n        </li>\r\n        <li class='profile__linksItem'>\r\n          "+(null!=(l=typeof(s=null!=(s=p(n,"LogoutLink")||(null!=t?p(t,"LogoutLink"):t))?s:i)===u?s.call(o,{name:"LogoutLink",hash:{},data:a,loc:{start:{line:45,column:10},end:{line:45,column:26}}}):s)?l:"")+"\r\n        </li>\r\n      </ul>\r\n    </div>\r\n  </div>\r\n</main>"},useData:!0});const Xe=T(class extends W{constructor(e){super(e)}init(){const e=this.props.router,t=this.props.authController;this.children.GoBackBtn=new Fe({events:{click(){e.back()}}}),this.children.ChangeDataLink=new ke({href:"/",text:"Изменить данные",styles:"profile__link",events:{click(t){t.preventDefault(),e.go(f.EditProfilePage)}}}),this.children.LogoutLink=new ke({href:"/",text:"Выйти",styles:"profile__link",events:{async click(e){e.preventDefault(),await t.logout()}}}),this.children.ChangePasswordLink=new ke({href:"/",text:"Изменить пароль",styles:"profile__link",events:{click(t){t.preventDefault(),e.go(f.EditPasswordPage)}}})}render(){return this.compile(Ke,{...this.children,email:this.props.user?.email,login:this.props.user?.login,name:this.props.user?.first_name,surname:this.props.user?.second_name,chatName:"Bla",telephone:this.props.user?.phone,avatarSrc:this.props.avatarSrc})}},{router:new _("#app"),authController:new A});var Ye=U((e=>({user:e.user,avatarSrc:e.user?.avatar})))(Xe);var Qe=t($).template({compiler:[8,">= 4.3.0"],main:function(e,t,n,r,a){var l,s,o=null!=t?t:e.nullContext||{},i=e.hooks.helperMissing,u="function",c=e.lookupProperty||function(e,t){if(Object.prototype.hasOwnProperty.call(e,t))return e[t]};return"<main class='mainGrid'>\r\n  <div class='auth'>\r\n    <h2 class='auth__header'>Вход</h2>\r\n    "+(null!=(l=typeof(s=null!=(s=c(n,"form")||(null!=t?c(t,"form"):t))?s:i)===u?s.call(o,{name:"form",hash:{},data:a,loc:{start:{line:4,column:4},end:{line:4,column:14}}}):s)?l:"")+"\r\n    "+(null!=(l=typeof(s=null!=(s=c(n,"signUpLink")||(null!=t?c(t,"signUpLink"):t))?s:i)===u?s.call(o,{name:"signUpLink",hash:{},data:a,loc:{start:{line:5,column:4},end:{line:5,column:20}}}):s)?l:"")+"\r\n  </div>\r\n</main>\r\n"},useData:!0});let et;!function(e){e.Login="login",e.Password="password"}(et||(et={}));const tt=(e,t,n)=>{const r=e.trim();return t.test(r)?null:n},nt={[et.Login]:e=>tt(e,/^[a-zA-Z][a-zA-Z0-9\-_]{3,20}$/,"от 3 до 20 символов, латиница, может содержать цифры, но не состоять из них, без пробелов, без спецсимволов (допустимы дефис и нижнее подчёркивание)"),[et.Password]:e=>tt(e,/^(?=.*[a-z])(?=.*[A-Z])(?=.*\d)(?=.*[^\da-zA-Z]).{8,40}$/,"от 8 до 40 символов, обязательно хотя бы одна заглавная буква и цифра")};const rt=T(class extends W{constructor(e){super(e)}init(){const e=new ne({inputStyle:"inputField__input",type:"text",name:"login"}),t=new ne({inputStyle:"inputField__input",type:"password",name:"password"}),n=[e,t],r=[new K({name:"login",label:"Логин *",input:e}),new K({name:"password",label:"Пароль *",input:t})],a=new z({label:"Войти",stylesType:q.Submit,containerStyles:"authForm__submitBtn"});this.children.form=new Q({fields:r,submitBtn:a,submit:async e=>{try{await this.props.auth.signIn(e)}catch(e){const t=e.reason;a.props.actionError=t}},inputs:n,validationRules:nt,formClass:"authForm"}),this.children.signUpLink=new ke({href:"/",text:"Нет аккаунта?",styles:"auth__link",events:{click:e=>{e.preventDefault(),this.props.router.go(f.SignUpPage)}}})}render(){return this.compile(Qe,this.children)}},{auth:new A,router:new _("#app")});var at=U((e=>e.user))(rt);var lt=t($).template({compiler:[8,">= 4.3.0"],main:function(e,t,n,r,a){var l,s,o=null!=t?t:e.nullContext||{},i=e.hooks.helperMissing,u="function",c=e.lookupProperty||function(e,t){if(Object.prototype.hasOwnProperty.call(e,t))return e[t]};return"<div>\r\n  <main class='mainGrid'>\r\n    <div class='auth'>\r\n      <h2 class='auth__header'>Регистрация</h2>\r\n      "+(null!=(l=typeof(s=null!=(s=c(n,"form")||(null!=t?c(t,"form"):t))?s:i)===u?s.call(o,{name:"form",hash:{},data:a,loc:{start:{line:5,column:6},end:{line:5,column:16}}}):s)?l:"")+"\r\n      "+(null!=(l=typeof(s=null!=(s=c(n,"signInLink")||(null!=t?c(t,"signInLink"):t))?s:i)===u?s.call(o,{name:"signInLink",hash:{},data:a,loc:{start:{line:6,column:6},end:{line:6,column:22}}}):s)?l:"")+"\r\n    </div>\r\n  </main>\r\n</div>\r\n"},useData:!0});let st;!function(e){e.Name="first_name",e.Surname="second_name",e.Login="login",e.Email="email",e.Phone="phone",e.Password="password"}(st||(st={}));const ot=(e,t,n)=>{const r=e.trim();return t.test(r)?null:n},it={[st.Name]:e=>ot(e,/^[A-ZА-Я][\p{L}]*$/u,"Латиница или кириллица, первая буква должна быть заглавной, без пробелов и без цифр, нет спецсимволов"),[st.Surname]:e=>ot(e,/^[A-ZА-Я][\p{L}]*$/u,"Латиница или кириллица, первая буква должна быть заглавной, без пробелов и без цифр, нет спецсимволов"),[st.Login]:e=>ot(e,/^[a-zA-Z][a-zA-Z0-9\-_]{3,20}$/,"от 3 до 20 символов, латиница, может содержать цифры, но не состоять из них, без пробелов, без спецсимволов (допустимы дефис и нижнее подчёркивание)"),[st.Email]:e=>ot(e,/^[\w-.]+@([\w-]+\.)+[\w-]{2,4}$/,"латиница, может включать цифры и спецсимволы вроде дефиса, обязательно должна быть «собака» (@) и точка после неё, но перед точкой обязательно должны быть буквы"),[st.Password]:e=>ot(e,/^(?=.*[a-z])(?=.*[A-Z])(?=.*\d)(?=.*[^\da-zA-Z]).{8,40}$/,"от 8 до 40 символов, обязательно хотя бы одна заглавная буква и цифра"),[st.Phone]:e=>ot(e,/^\+?[0-9]{10,15}$/,"От 10 до 15 символов, состоит из цифр, может начинается с плюса")};const ut=T(class extends W{constructor(e){super(e)}init(){const e=new ne({inputStyle:"inputField__input",type:"text",name:st.Name}),t=new ne({inputStyle:"inputField__input",type:"text",name:st.Surname}),n=new ne({inputStyle:"inputField__input",type:"text",name:st.Login}),r=new ne({inputStyle:"inputField__input",type:"email",name:st.Email}),a=new ne({inputStyle:"inputField__input",type:"tel",name:st.Phone}),l=new ne({inputStyle:"inputField__input",type:"password",name:st.Password}),s=[e,t,n,r,a,l],o=[new K({name:st.Name,label:"Имя",input:e}),new K({name:st.Surname,label:"Фамилия",input:t}),new K({name:st.Login,label:"Логин *",input:n}),new K({name:st.Email,label:"Email *",input:r}),new K({name:st.Phone,label:"Телефон *",input:a}),new K({name:st.Password,label:"Пароль *",input:l})],i=new z({label:"Зарегистрироваться",stylesType:q.Submit,styles:"authForm__signUpBtn"});this.children.form=new Q({fields:o,submitBtn:i,submit:async e=>{try{await this.props.auth.signUp(e)}catch(e){const t=e.reason;i.props.actionError=t}},inputs:s,validationRules:it,formClass:"authForm"}),this.children.signInLink=new ke({href:"/",text:"Уже есть аккаунт?",styles:"auth__link",events:{click:e=>{e.preventDefault(),this.props.router.go(f.SignInPage)}}})}render(){return this.compile(lt,this.children)}},{auth:new A,router:new _("#app")});var ct=U((e=>e.user))(ut);window.addEventListener("DOMContentLoaded",(async()=>{new _("#app").use(f.SignInPage,at,{}).use(f.SignUpPage,ct,{}).use(f.Chat,Ae,{}).use(f.EditProfilePage,Ze,{}).use(f.EditPasswordPage,He,{}).use(f.Profile,Ye,{}).use(f.NotFoundPage,Je,{statusCode:404,text:"Не найдено"}).use(f.ServerError,Je,{statusCode:500,text:"Что-то пошло не так"}).start();const e=new A;await e.getUser()}));
//# sourceMappingURL=index.1ef64394.js.map
